---
title: "US model & SG data on US model & SG model"
author: "Wu Yiyang"
date: "2024-02-03"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(MASS)
library(readr)
library(tidyverse)
library(readr)
library(ggplot2)
library(corrplot)
library(dplyr)

## Load and filter data
dat <- read_csv("~/OneDrive - University of Toronto/Digital Proxy Practicum/Cleaned data/cleaned_combined.csv")
my.dat <- dat
# view(my.dat)
```


```{r}
#define function to scale values between 0 and 1
scale_values <- function(x){(x-min(x))/(max(x)-min(x))}

# Factorize Demographics -------------------------------------------------
my.dat$Country <- factor(my.dat$Country, levels = c("US","SG"), labels = c("US","SG"))

my.dat$Marital[is.na(my.dat$Marital)] = "3"
my.dat$Marital <- factor(my.dat$Marital, 
                         levels = c("Unmarried","Married","Div/Sep","Widowed"),
                         labels = c("Unmarried","Married","Once Married","Once Married"), ordered = TRUE)

#my.dat$Marital[is.na(my.dat$Marital)] = "Not Specified"
#my.dat$Marital <- factor(my.dat$Marital, 
#                         levels = c("Married","Unmarried","Div/Sep","Widowed","Not Specified"),
#                         labels = c("1","2","3","3","4"), ordered = TRUE)
#my.dat$Marital <- as.numeric(my.dat$Marital) 

ordering <- c("21","25", "30", "35", "40", "45", "50", "55", "60", "65", "70")
orderFactor <- factor(my.dat$Age, levels = ordering)
my.dat$Age <- as.numeric(orderFactor)

my.dat$Housing <- factor(my.dat$Housing, 
                         levels = c("low-income housing", "apartment", "familyhouse"),
                         labels = c("0", "1", "2"), ordered = TRUE)
my.dat$Housing <- as.factor(as.character(my.dat$Housing))
my.dat$Housing <- as.numeric(my.dat$Housing) ###

ordering <- c("<$30k", "$30k", "$50k", "$100k", "$150k", ">$200k")
orderFactor <- factor(my.dat$Income, levels = ordering)
my.dat$Income <- as.numeric(orderFactor)

my.dat$Gender <- as.factor(my.dat$Gender)
my.dat$Gender <- as.numeric(my.dat$Gender) ###

my.dat$Ethnicity <- factor(my.dat$Ethnicity, 
                           levels = c("White", "His/Lat", "Black", "Mixed", "Asian", "Others", "Native", "Chinese", "Malay", "Indian", "Eurasian"),
                           labels = c("Majority", "Underrepresented", "Underrepresented", "Underrepresented", "Underrepresented", "Underrepresented", "Underrepresented", "Majority", "Underrepresented", "Underrepresented", "Underrepresented"))
my.dat$Ethnicity <- as.factor(as.character(my.dat$Ethnicity))
my.dat$Ethnicity <- as.numeric(my.dat$Ethnicity) ###
# table(my.dat$Ethnicity)
# table(test.data.us$Ethnicity)
# table(test.data.sg$Ethnicity)

# religion
filterCountryData <- function(xyz) { # create a function with the name my_function
  test<-my.dat%>%
    filter(Country==xyz)%>%
  return(test)
}
#digital_proxyUS <- filterCountryData("US")
#unique(digital_proxyUS$Religion)
#digital_proxySG <- filterCountryData("SG")
#unique(digital_proxySG$Religion)

my.dat$Religion <- factor(my.dat$Religion, 
                           levels = c("Christian", "No Religion", "Catholic", "Jehovah Witness", "Muslim", "Mormon", "Spiritualist", "Pagan", "Jewish", "Hindu", "Buddhist", "Agnostic","Buddhism","Catholicism","No Religion","Islam","Christianity","Taoism","Hinduism"),
                           labels = c("Christian", "No Religion", "Catholic", "Jehovah Witness", "Muslim", "Mormon", "Spiritualist", "Pagan", "Jewish", "Hindu", "Buddhist", "Agnostic","Buddhism","Catholicism","No Religion","Islam","Christianity","Taoism","Hinduism"))
my.dat$Religion <- as.factor(as.character(my.dat$Religion))

my.dat$Education <- factor(my.dat$Education, 
                           levels = c("Below", "High", "Degree and above"),
                           labels = c("< High School", "High School", "Degree and above"), ordered = TRUE)
ordering <- c("< High School", "High School", "Degree and above")
orderFactor <- factor(my.dat$Education, levels = ordering)
my.dat$Education <- as.numeric(orderFactor)

my.dat$Employment <- factor(my.dat$Employment, 
                            levels = c("Disabled","Retired","Student","Unemployed","Full-time","Part-time","Self"),
                            labels = c("Unemployed","Unemployed","Unemployed","Unemployed","Employed","Employed","Employed"), ordered = TRUE)
my.dat$Employment <- as.factor(as.character(my.dat$Employment))
my.dat$Employment <- as.numeric(my.dat$Employment) ###

ordering <- c("0","1","2","3",">4")
orderFactor <- factor(my.dat$Siblings, levels = ordering)
my.dat$Siblings <- as.numeric(orderFactor)

ordering <- c("Youngest","Middle","Oldest")
orderFactor <- factor(my.dat$SiblingsOrder, levels = ordering)
my.dat$SiblingsOrder <- as.numeric(orderFactor)

# Factorize Physical Help -------------------------------------------------
my.dat$HelpImmediateFam = factor(my.dat$HelpImmediateFam, 
                                 levels = c("0","1","2","3","4","5","6","7","8","9","10","11","12","15","17","20","25",">30"), 
                                 labels = c("0","1","2","3","4","5","6","7","8","9","10","11","12","15","17","20","25","31"))
my.dat$HelpImmediateFam <- as.numeric(as.character(my.dat$HelpImmediateFam))

# in relatives
my.dat$HelpRelatives = factor(my.dat$HelpRelatives, 
                              levels = c("0","1","2","3","4","5","6","9","10","16","20","29",">30"), 
                              labels = c("0","1","2","3","4","5","6","9","10","16","20","29","31"))
my.dat$HelpRelatives <- as.numeric(as.character(my.dat$HelpRelatives))

# in Friends
my.dat$HelpFriends = factor(my.dat$HelpFriends, 
                            levels = c("0","1","2","3","4","5","6","7","8","10","11","12","15","20","25","30",">30",">=100"), 
                            labels = c("0","1","2","3","4","5","6","7","8","10","11","12","15","20","25","30","31","101"))
my.dat$HelpFriends <- as.numeric(as.character(my.dat$HelpFriends))

# in Pass Away
my.dat$HelpPassAway[is.na(my.dat$HelpPassAway)] = -1
my.dat$HelpPassAway = factor(my.dat$HelpPassAway, 
                             levels = c("-1","0","1","2","3",">3"), 
                             labels = c("-1","0","1","2","3","4"))
my.dat$HelpPassAway <- as.numeric(as.character(my.dat$HelpPassAway))

# Factorize Financial Help -------------------------------------------------
my.dat$FinanceHelpImmediateFam = factor(my.dat$FinanceHelpImmediateFam, 
                                        levels = c("0","1","2","3","4","5","6","10","12","18","20",">30"), 
                                        labels = c("0","1","2","3","4","5","6","10","12","18","20","31"))
my.dat$FinanceHelpImmediateFam <- as.numeric(as.character(my.dat$FinanceHelpImmediateFam))

# in relatives
my.dat$FinanceHelpRelatives = factor(my.dat$FinanceHelpRelatives, 
                                     levels = c("0","1","2","3","5","6","7","8","10","20","30",">30"), 
                                     labels = c("0","1","2","3","5","6","7","8","10","20","30","31"))
my.dat$FinanceHelpRelatives <- as.numeric(as.character(my.dat$FinanceHelpRelatives))

# in Friends
my.dat$FinanceHelpFriends = factor(my.dat$FinanceHelpFriends, 
                                   levels = c("0","1","2","3","4","5","6","7","9","10","12","15","20",">30",">100"), 
                                   labels = c("0","1","2","3","4","5","6","7","9","10","12","15","20","31","101"))
my.dat$FinanceHelpFriends <- as.numeric(as.character(my.dat$FinanceHelpFriends))


# in Pass Away
my.dat$FinanceHelpPassAway[is.na(my.dat$FinanceHelpPassAway)] = -1
my.dat$FinanceHelpPassAway = factor(my.dat$FinanceHelpPassAway, 
                                    levels = c("-1","0","1","2","3",">3"), 
                                    labels = c("-1","0","1","2","3","4"))
my.dat$FinanceHelpPassAway <- as.numeric(as.character(my.dat$FinanceHelpPassAway))

# Factorize Medical Help -------------------------------------------------
my.dat$MedicalHelpImmediateFam = factor(my.dat$MedicalHelpImmediateFam, 
                                        levels = c("0","1","2","3","4","5","6","10","12","18","20",">30",">100"), 
                                        labels = c("0","1","2","3","4","5","6","10","12","18","20","31","101"))
my.dat$MedicalHelpImmediateFam <- as.numeric(as.character(my.dat$MedicalHelpImmediateFam))

# in relatives
my.dat$MedicalHelpRelatives = factor(my.dat$MedicalHelpRelatives, 
                                     levels = c("0","1","2","3","4","5","6","7","10","20",">30"), 
                                     labels = c("0","1","2","3","4","5","6","7","10","20","31"))
my.dat$MedicalHelpRelatives <- as.numeric(as.character(my.dat$MedicalHelpRelatives))

# in Friends
my.dat$MedicalHelpFriends = factor(my.dat$MedicalHelpFriends, 
                                   levels = c("0","1","2","3","4","5","6","7","10","15","20","26",">30",">=100"), 
                                   labels = c("0","1","2","3","4","5","6","7","10","15","20","26","31","101"))
my.dat$MedicalHelpFriends <- as.numeric(as.character(my.dat$MedicalHelpFriends))

# in Pass Away
my.dat$MedicalHelpPassAway[is.na(my.dat$MedicalHelpPassAway)] = -1
my.dat$MedicalHelpPassAway = factor(my.dat$MedicalHelpPassAway, 
                                    levels = c("-1","0","1","2","3",">3"), 
                                    labels = c("-1","0","1","2","3","4"))
my.dat$MedicalHelpPassAway <- as.numeric(as.character(my.dat$MedicalHelpPassAway))

# Factorize IADL -------------------------------------------------
# in Help with Food
my.dat$HelpFood = factor(my.dat$HelpFood,
                         levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                         labels = c("0","1","2","3","4"))
my.dat$HelpFood <- as.numeric(as.character(my.dat$HelpFood))

# in Help with Housekeeping
my.dat$HelpHousekeep = factor(my.dat$HelpHousekeep,
                              levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                              labels = c("0","1","2","3","4"))
my.dat$HelpHousekeep <- as.numeric(as.character(my.dat$HelpHousekeep))

# in Help with Laundry
my.dat$HelpLaundry = factor(my.dat$HelpLaundry,
                            levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                            labels = c("0","1","2","3","4"))
my.dat$HelpLaundry <- as.numeric(as.character(my.dat$HelpLaundry))

# in Help with Transport
my.dat$HelpTransport = factor(my.dat$HelpTransport,
                              levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                              labels = c("0","1","2","3","4"))
my.dat$HelpTransport <- as.numeric(as.character(my.dat$HelpTransport))

# in Help with Medicine
my.dat$HelpMed = factor(my.dat$HelpMed,
                        levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                        labels = c("0","1","2","3","4"))
my.dat$HelpMed <- as.numeric(as.character(my.dat$HelpMed))

# in Help with Finance
my.dat$HelpFinance = factor(my.dat$HelpFinance,
                            levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                            labels = c("0","1","2","3","4"))
my.dat$HelpFinance <- as.numeric(as.character(my.dat$HelpFinance))

# in Help with Digital Service
my.dat$HelpDigital = factor(my.dat$HelpDigital,
                            levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                            labels = c("0","1","2","3","4"))
my.dat$HelpDigital <- as.numeric(as.character(my.dat$HelpDigital))

# Factorize IADL(future) -------------------------------------------------
# in Help with Food
my.dat$HelpFoodFuture[is.na(my.dat$HelpFoodFuture)] = "-1"
my.dat$HelpFoodFuture = factor(my.dat$HelpFoodFuture,
                               levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                               labels = c("-1","0","1","2","3","4"))
my.dat$HelpFoodFuture <- as.numeric(as.character(my.dat$HelpFoodFuture))

# in Help with Housekeeping
my.dat$HelpHousekeepFuture[is.na(my.dat$HelpHousekeepFuture)] = "-1"
my.dat$HelpHousekeepFuture = factor(my.dat$HelpHousekeepFuture,
                                    levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                    labels = c("-1","0","1","2","3","4"))
my.dat$HelpHousekeepFuture <- as.numeric(as.character(my.dat$HelpHousekeepFuture))

# in Help with Laundry
my.dat$HelpLaundryFuture[is.na(my.dat$HelpLaundryFuture)] = "-1"
my.dat$HelpLaundryFuture = factor(my.dat$HelpLaundryFuture,
                                  levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                  labels = c("-1","0","1","2","3","4"))
my.dat$HelpLaundryFuture <- as.numeric(as.character(my.dat$HelpLaundryFuture))

# in Help with Transport
my.dat$HelpTransportFuture[is.na(my.dat$HelpTransportFuture)] = "-1"
my.dat$HelpTransportFuture = factor(my.dat$HelpTransportFuture,
                                    levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                    labels = c("-1","0","1","2","3","4"))
my.dat$HelpTransportFuture <- as.numeric(as.character(my.dat$HelpTransportFuture))

# in Help with Medicine
my.dat$HelpMedFuture[is.na(my.dat$HelpMedFuture)] = "-1"
my.dat$HelpMedFuture = factor(my.dat$HelpMedFuture,
                              levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                              labels = c("-1","0","1","2","3","4"))
my.dat$HelpMedFuture <- as.numeric(as.character(my.dat$HelpMedFuture))

# in Help with Finance
my.dat$HelpFinanceFuture[is.na(my.dat$HelpFinanceFuture)] = "-1"
my.dat$HelpFinanceFuture = factor(my.dat$HelpFinanceFuture,
                                  levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                  labels = c("-1","0","1","2","3","4"))
my.dat$HelpFinanceFuture <- as.numeric(as.character(my.dat$HelpFinanceFuture))

# in Help with Digital Service
my.dat$HelpDigitalFuture[is.na(my.dat$HelpDigitalFuture)] = "-1"
my.dat$HelpDigitalFuture = factor(my.dat$HelpDigitalFuture,
                                  levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                  labels = c("-1","0","1","2","3","4"))
my.dat$HelpDigitalFuture <- as.numeric(as.character(my.dat$HelpDigitalFuture))

# Factorize ADL -------------------------------------------------
# in ADL Bathing
my.dat$ADLBath = factor(my.dat$ADLBath,
                        levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                        labels = c("0","1","2","3","4"))
my.dat$ADLBath <- as.numeric(as.character(my.dat$ADLBath))

# in ADL Grooming
my.dat$ADLGroom = factor(my.dat$ADLGroom,
                         levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                         labels = c("0","1","2","3","4"))
my.dat$ADLGroom <- as.numeric(as.character(my.dat$ADLGroom))

# in ADL Toileting
my.dat$ADLToilet = factor(my.dat$ADLToilet,
                          levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                          labels = c("0","1","2","3","4"))
my.dat$ADLToilet <- as.numeric(as.character(my.dat$ADLToilet))

# in ADL Transferring
my.dat$ADLTransfer = factor(my.dat$ADLTransfer,
                            levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                            labels = c("0","1","2","3","4"))
my.dat$ADLTransfer <- as.numeric(as.character(my.dat$ADLTransfer))

# in ADL Incontinence
my.dat$ADLIncontinence = factor(my.dat$ADLIncontinence,
                                levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                                labels = c("0","1","2","3","4"))
my.dat$ADLIncontinence <- as.numeric(as.character(my.dat$ADLIncontinence))

# in ADL Feeding
my.dat$ADLFeed = factor(my.dat$ADLFeed,
                        levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                        labels = c("0","1","2","3","4"))
my.dat$ADLFeed <- as.numeric(as.character(my.dat$ADLFeed))

# Factorize Financial Task -------------------------------------------------
# in Help with Decision Support
my.dat$FinanceDecisionSupport = factor(my.dat$FinanceDecisionSupport,
                                       levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                                       labels = c("0","1","2","3","4"))
my.dat$FinanceDecisionSupport <- as.numeric(as.character(my.dat$FinanceDecisionSupport))

# in Help with Finance Action
my.dat$FinanceAction = factor(my.dat$FinanceAction,
                              levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                              labels = c("0","1","2","3","4"))
my.dat$FinanceAction <- as.numeric(as.character(my.dat$FinanceAction))

# in Help with Finance LPA
my.dat$FinanceLPA = factor(my.dat$FinanceLPA,
                           levels = c("No","Yes"),
                           labels = c("0","1"))
my.dat$FinanceLPA <- as.numeric(as.character(my.dat$FinanceLPA))

# in Help with Finance LPA Personal Use
my.dat$FinanceLPAUsePersonal[is.na(my.dat$FinanceLPAUsePersonal)] = "-1"
my.dat$FinanceLPAUsePersonal = factor(my.dat$FinanceLPAUsePersonal,
                                      levels = c("-1","Never","Rarely","Sometimes","Frequently","Always"),
                                      labels = c("-1","0","1","2","3","4"))
my.dat$FinanceLPAUsePersonal <- as.numeric(as.character(my.dat$FinanceLPAUsePersonal))

# in Help with Finance LPA Property Use
my.dat$FinanceLPAUseProperty[is.na(my.dat$FinanceLPAUseProperty)] = "-1"
my.dat$FinanceLPAUseProperty = factor(my.dat$FinanceLPAUseProperty,
                                      levels = c("-1","Never","Rarely","Sometimes","Frequently","Always"),
                                      labels = c("-1","0","1","2","3","4"))
my.dat$FinanceLPAUseProperty <- as.numeric(as.character(my.dat$FinanceLPAUseProperty))

# in Help with Finance LPA Property Use
#my.dat$FinanceLPAYear[is.na(my.dat$FinanceLPAYear)] = "-1"
#my.dat$FinanceLPAYear = factor(my.dat$FinanceLPAYear,
#                                      levels = c("-1","<EPA","'82","'88","'87","'89","'90","'91","'92","'94","'95","'98",
#                                                 "'99","'00","'01","'02","'04","'05","'06","'07","'08","'09","'10",
#                                                 "'11","'12","'13","'14","'15","'16","'17","'18","'19","'20","'21","'22","Future"),
#                                      labels = c("-1","<EPA","'82","'88","'87","'89","'90","'91","'92","'94","'95","'98",
#                                                 "'99","'00","'01","'02","'04","'05","'06","'07","'08","'09","'10",
#                                                 "'11","'12","'13","'14","'15","'16","'17","'18","'19","'20","'21","'22","Future"))
#my.dat$FinanceLPAYear <- as.numeric(as.character(my.dat$FinanceLPAYear))

# Factorize Financial Task (Future)-------------------------------------------------
# in Help with Decision Support
my.dat$FinanceDecisionSupportFuture[is.na(my.dat$FinanceDecisionSupportFuture)] = "-1"
my.dat$FinanceDecisionSupportFuture = factor(my.dat$FinanceDecisionSupportFuture,
                                             levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                             labels = c("-1","0","1","2","3","4"))
my.dat$FinanceDecisionSupportFuture <- as.numeric(as.character(my.dat$FinanceDecisionSupportFuture))

# in Help with Finance Action
my.dat$FinanceActionFuture[is.na(my.dat$FinanceActionFuture)] = "-1"
my.dat$FinanceActionFuture = factor(my.dat$FinanceActionFuture,
                                    levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                    labels = c("-1","0","1","2","3","4"))
my.dat$FinanceActionFuture <- as.numeric(as.character(my.dat$FinanceActionFuture))

# Factorize Medical Task Low Stake -------------------------------------------------
# in Help with Making Medical Appt
my.dat$MedicalMakeAppt = factor(my.dat$MedicalMakeAppt,
                                levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                                labels = c("0","1","2","3","4"))
my.dat$MedicalMakeAppt <- as.numeric(as.character(my.dat$MedicalMakeAppt))

# in Accompanying with Medical Appt
my.dat$MedicalAccompanyAppt = factor(my.dat$MedicalAccompanyAppt,
                                     levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                                     labels = c("0","1","2","3","4"))
my.dat$MedicalAccompanyAppt <- as.numeric(as.character(my.dat$MedicalAccompanyAppt))

# in Help with Taking Medicine
my.dat$MedicalTakeMeds = factor(my.dat$MedicalTakeMeds,
                                levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                                labels = c("0","1","2","3","4"))
my.dat$MedicalTakeMeds <- as.numeric(as.character(my.dat$MedicalTakeMeds))

# in Help with Overseeing Treatment
my.dat$MedicalSeeTreatment = factor(my.dat$MedicalSeeTreatment,
                                    levels = c("Never","Yearly","Monthly","Weekly","Daily"),
                                    labels = c("0","1","2","3","4"))
my.dat$MedicalSeeTreatment <- as.numeric(as.character(my.dat$MedicalSeeTreatment))

# Factorize Medical Task Low Stake (future) -------------------------------------------------
my.dat$MedicalMakeApptFuture[is.na(my.dat$MedicalMakeApptFuture)] = "-1"
my.dat$MedicalMakeApptFuture = factor(my.dat$MedicalMakeApptFuture,
                                      levels = c("-1","V.lnlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                      labels = c("-1","0","1","2","3","4"))
my.dat$MedicalMakeApptFuture <- as.numeric(as.character(my.dat$MedicalMakeApptFuture))

my.dat$MedicalAccompanyApptFuture[is.na(my.dat$MedicalAccompanyApptFuture)] = "-1"
my.dat$MedicalAccompanyApptFuture = factor(my.dat$MedicalAccompanyApptFuture,
                                           levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                           labels = c("-1","0","1","2","3","4"))
my.dat$MedicalAccompanyApptFuture <- as.numeric(as.character(my.dat$MedicalAccompanyApptFuture))

my.dat$MedicalTakeMedsFuture[is.na(my.dat$MedicalTakeMedsFuture)] = "-1"
my.dat$MedicalTakeMedsFuture = factor(my.dat$MedicalTakeMedsFuture,
                                      levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                      labels = c("-1","0","1","2","3","4"))
my.dat$MedicalTakeMedsFuture <- as.numeric(as.character(my.dat$MedicalTakeMedsFuture))

my.dat$MedicalSeeTreatmentFuture[is.na(my.dat$MedicalSeeTreatmentFuture)] = "-1"
my.dat$MedicalSeeTreatmentFuture = factor(my.dat$MedicalSeeTreatmentFuture,
                                          levels = c("-1","V.unlikely","S.unLikely","Unsure","S.likely","V.likely"),
                                          labels = c("-1","0","1","2","3","4"))
my.dat$MedicalSeeTreatmentFuture <- as.numeric(as.character(my.dat$MedicalSeeTreatmentFuture))

# Factorize Medical Task High Stake -------------------------------------------------
# Making medical decisions
my.dat$MedicalDecisionPerson = factor(my.dat$MedicalDecisionPerson,
                                      levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                      labels = c("0","1","2"))
my.dat$MedicalDecisionPerson <- as.numeric(as.character(my.dat$MedicalDecisionPerson))

my.dat$MedicalDecisionDoctor = factor(my.dat$MedicalDecisionDoctor,
                                      levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                      labels = c("0","1","2"))
my.dat$MedicalDecisionDoctor <- as.numeric(as.character(my.dat$MedicalDecisionDoctor))

my.dat$MedicalSignPapers = factor(my.dat$MedicalSignPapers,
                                  levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                  labels = c("0","1","2"))
my.dat$MedicalSignPapers <- as.numeric(as.character(my.dat$MedicalSignPapers))

my.dat$MedicalDecision = rowSums(my.dat[ , c("MedicalDecisionPerson","MedicalDecisionDoctor","MedicalSignPapers")]) 

# Quality of life
my.dat$MedicalWorthPerson = factor(my.dat$MedicalWorthPerson,
                                   levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                   labels = c("0","1","2"))
my.dat$MedicalWorthPerson <- as.numeric(as.character(my.dat$MedicalWorthPerson))

my.dat$MedicalWorthDoctor = factor(my.dat$MedicalWorthDoctor,
                                   levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                   labels = c("0","1","2"))
my.dat$MedicalWorthDoctor <- as.numeric(as.character(my.dat$MedicalWorthDoctor))

my.dat$MedicalWorthFamily = factor(my.dat$MedicalWorthFamily,
                                   levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                   labels = c("0","1","2"))
my.dat$MedicalWorthFamily <- as.numeric(as.character(my.dat$MedicalWorthFamily))

my.dat$MedicalWorth = rowSums(my.dat[ , c("MedicalWorthPerson","MedicalWorthDoctor","MedicalWorthFamily")]) 

# Medical Care - end of life
my.dat$MedicalEndPerson = factor(my.dat$MedicalEndPerson,
                                 levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                 labels = c("0","1","2"))
my.dat$MedicalEndPerson <- as.numeric(as.character(my.dat$MedicalEndPerson))

my.dat$MedicalEndDoctor = factor(my.dat$MedicalEndDoctor,
                                 levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                 labels = c("0","1","2"))
my.dat$MedicalEndDoctor <- as.numeric(as.character(my.dat$MedicalEndDoctor))

my.dat$MedicalEndFamily = factor(my.dat$MedicalEndFamily,
                                 levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                 labels = c("0","1","2"))
my.dat$MedicalEndFamily <- as.numeric(as.character(my.dat$MedicalEndFamily))

my.dat$MedicalEnd = rowSums(my.dat[ , c("MedicalEndPerson","MedicalEndDoctor","MedicalEndFamily")]) 

# Flexibility for Surrogate in Making Decisions
my.dat$MedicalFlexibilityPerson = factor(my.dat$MedicalFlexibilityPerson,
                                         levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                         labels = c("0","1","2"))
my.dat$MedicalFlexibilityPerson <- as.numeric(as.character(my.dat$MedicalFlexibilityPerson))

my.dat$MedicalFlexibilityDoctor = factor(my.dat$MedicalFlexibilityDoctor,
                                         levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                         labels = c("0","1","2"))
my.dat$MedicalFlexibilityDoctor <- as.numeric(as.character(my.dat$MedicalFlexibilityDoctor))

my.dat$MedicalFlexibilityFamily = factor(my.dat$MedicalFlexibilityFamily,
                                         levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                         labels = c("0","1","2"))
my.dat$MedicalFlexibilityFamily <- as.numeric(as.character(my.dat$MedicalFlexibilityFamily))

my.dat$MedicalDoctorQuestions = factor(my.dat$MedicalDoctorQuestions,
                                       levels = c("No, because I didn't need to","No, but I should have","Yes"),
                                       labels = c("0","1","2"))
my.dat$MedicalDoctorQuestions <- as.numeric(as.character(my.dat$MedicalDoctorQuestions))

my.dat$MedicalSurrogate = rowSums(my.dat[ , c("MedicalFlexibilityPerson","MedicalFlexibilityDoctor","MedicalFlexibilityFamily","MedicalDoctorQuestions")]) 

my.dat$MedicalHighStake = rowSums(my.dat[ , c("MedicalDecision","MedicalWorth","MedicalEnd","MedicalSurrogate")]) 
my.dat$MedicalHighStake <- scale_values(my.dat$MedicalHighStake)
my.dat$MedicalHighStake <- round(my.dat$MedicalHighStake ,digit=2)

# in Managing with Caregiver Account (Num)
unique(my.dat$DigitalCaregiverAccountNum)
my.dat$DigitalCaregiverAccountNum = factor(my.dat$DigitalCaregiverAccountNum,
                                           levels = c("0","1","2","3","4","5","8","10","12","17","23",">30",">=100"),
                                           labels = c("0","1","2","3","4","5","8","10","12","17","23","31","100"))
my.dat$DigitalCaregiverAccountNum <- as.numeric(as.character(my.dat$DigitalCaregiverAccountNum))

# GROUPING DIGITAL DELEGATE HERE >> IMPORTANT-------------------------------------------------
#Q5.15: I have a joint account (note: the raw values can be retrieved via 'FinanceJointAccount_raw' variable)
my.dat$FinanceJointAccount = factor(my.dat$FinanceJointAccount,
                                    levels = c("No","Yes","Unsure"),
                                    labels = c("0","1","0"))
my.dat$FinanceJointAccount <- as.numeric(as.character(my.dat$FinanceJointAccount))

#Q5.17: I have helped with digital financial access
my.dat$FinanceDigitalAssistance = factor(my.dat$FinanceDigitalAssistance,
                                         levels = c("No","Yes"),
                                         labels = c("0","1"))
my.dat$FinanceDigitalAssistance <- as.numeric(as.character(my.dat$FinanceDigitalAssistance))

#Q5.19: Own a separate account (note: the raw values can be retrieved via 'FinanceLoginWays' variable)
my.dat$FinanceLoginInstitution[is.na(my.dat$FinanceLoginWays_institution)] = "2"
my.dat$FinanceLoginInstitution = factor(my.dat$FinanceLoginWays_institution,
                                        levels = c("No","Yes"),
                                        labels = c("0","1"))
my.dat$FinanceLoginInstitution <- as.numeric(as.character(my.dat$FinanceLoginInstitution))

#Q6.33: I have a joint account
my.dat$DigitalCaregiverAccount = factor(my.dat$DigitalCaregiverAccount,
                                        levels = c("Unsure","No, but I should have","Yes"),
                                        labels = c("0","0","1"))
my.dat$DigitalCaregiverAccount <- as.numeric(as.character(my.dat$DigitalCaregiverAccount))

#Q6.36: I have assisted another adult with digital medical services
my.dat$DigitalAssistMedical = factor(my.dat$DigitalAssistMedical,
                                     levels = c("No",	"Yes"),
                                     labels = c("0",	"1"))
my.dat$DigitalAssistMedical <- as.numeric(as.character(my.dat$DigitalAssistMedical))

#Q6.38: My own separate account(note: the raw values can be retrieved via 'DigitalAssistAccessWays' variable)
my.dat$MedicalLoginInstitution[is.na(my.dat$DigitalAssistAccessWays_institution)] = "2"
my.dat$MedicalLoginInstitution = factor(my.dat$DigitalAssistAccessWays_institution,
                                        levels = c("No","Yes"),
                                        labels = c("0","1"))
my.dat$MedicalLoginInstitution <- as.numeric(as.character(my.dat$MedicalLoginInstitution))
```


```{r}
#CE + CG + CJ
#Y + Y + Y = formal
#Y + Y + N = formal
#N + Y + Y = Formal

#DO + DQ + DT 
#Y + Y + Y = formal
#Y + Y + N = formal
#N + Y + Y = formal

# DATA for Hypothesis Testing-------------------------------------------------
# 1) There is a positive relationship between physical care behaviors (IADLs and ADLs) and digital financial delegation helping behaviors
## filter: only approved survey entries
filtered.dat <- my.dat

# Function to filter out US or SG
country_data <- function(data, country) {
  temp_data <- subset(data, !(Country == country))
  return(temp_data)
}
us_filtered_data <- country_data(filtered.dat, "SG")

us_filtered_data <- subset(us_filtered_data, !(HelpFriends=="101"))
us_filtered_data <- subset(us_filtered_data, !(FinanceHelpFriends=="101"))
us_filtered_data <- subset(us_filtered_data, !(MedicalHelpImmediateFam=="101"))
us_filtered_data <- subset(us_filtered_data, !(MedicalHelpFriends=="101"))

us_filtered_data <- subset(us_filtered_data, !(HelpFriends=="31"))
us_filtered_data <- subset(us_filtered_data, !(FinanceHelpFriends=="31"))
us_filtered_data <- subset(us_filtered_data, !(MedicalHelpImmediateFam=="31"))
us_filtered_data <- subset(us_filtered_data, !(MedicalHelpFriends=="31"))
us_filtered_data <- subset(us_filtered_data, !(FinanceJointAccount=="Exclude"))
us_filtered_data <- subset(us_filtered_data, !(Marital=="3"))

# Create test dataframe with only demographic predictors
test.data.us = us_filtered_data[,c('Age','Income','Housing','Gender','Education','Employment','Ethnicity',
                            'Siblings','Marital')]

#how much help participants have provided for an adult in carrying out their instrumental activities of daily living
test.data.us$IADL = rowSums(us_filtered_data[ , c("HelpTransport","HelpMed","HelpFinance","HelpFood","HelpLaundry","HelpHousekeep")])
test.data.us$IADL <- scale_values(test.data.us$IADL)
test.data.us$IADL <- round(test.data.us$IADL ,digit=2)

#how much help participants have provided for an adult in carrying out their activities of daily living
test.data.us$ADL = rowSums(us_filtered_data[ , c("ADLBath","ADLFeed","ADLGroom","ADLIncontinence","ADLToilet","ADLTransfer")]) 
test.data.us$ADL <- scale_values(test.data.us$ADL)
test.data.us$ADL <- round(test.data.us$ADL ,digit=2)

#how much help participants have provided for an adult in carrying out low-stake medical care activities
test.data.us$lowstakeMed = rowSums(us_filtered_data[ , c("MedicalMakeAppt","MedicalAccompanyAppt","MedicalTakeMeds","MedicalSeeTreatment")])

#how much help participants have provided for an adult in carrying out high-stake medical care activities
test.data.us$highstakeMed = rowSums(us_filtered_data[ , c("MedicalDecisionPerson","MedicalDecisionDoctor","MedicalSignPapers","MedicalWorthPerson",
                                                   "MedicalWorthDoctor","MedicalWorthFamily","MedicalEndPerson","MedicalEndFamily",
                                                   "MedicalFlexibilityPerson","MedicalFlexibilityDoctor","MedicalFlexibilityFamily",
                                                   "MedicalDoctorQuestions")])

#DEPENDENT VARIABLES HERE
test.data.us$FinanceDelegate1 = as.factor(us_filtered_data$FinanceDelegate1)
test.data.us$FinanceDelegate2 = as.factor(us_filtered_data$FinanceDelegate2)
test.data.us$MedicalDelegate1 = as.factor(us_filtered_data$MedicalDelegate1)
test.data.us$MedicalDelegate2 = as.factor(us_filtered_data$MedicalDelegate2)

```


```{r}
#########-----------_financialDigitalDelegation START HERE-----------------
#Assist vs. No
test.data.us$FinanceDelegate1 = factor(test.data.us$FinanceDelegate1,
                                    levels = c("Assist","No"),
                                    labels = c("1","0"))
test.data.us$FinanceDelegate1 <- as.numeric(as.character(test.data.us$FinanceDelegate1))

modelFinLevel1 <- glm(FinanceDelegate1 ~ . - lowstakeMed - highstakeMed
                      - MedicalDelegate1 - MedicalDelegate2
                      - FinanceDelegate2, data=test.data.us, family = "binomial")

summary(modelFinLevel1)
modelFinLevel1_new <- stepAIC(modelFinLevel1)
summary(modelFinLevel1_new$fitted.values)
summary(modelFinLevel1_new)

confint(modelFinLevel1_new,level = 0.95)
confint.default(modelFinLevel1_new)
```

\newpage

# US financial model

Variable | Coefficient | Estimate | Standard Error | z-value | 95% CI | p-value |
| --- | --- | --- | --- | --- | --- | --- | 
|(Intercept) | $\hat{\beta}_0$ | -4.87 | 0.65 | -7.47 | [-6.18,-3.62] | 7.99e-14 *** | 
| Age | $\hat{\beta}_1$ | -0.07 | 0.04 | -2.06 | [-0.14,-0.004] | 0.039 * | 
| Income | $\hat{\beta}_2$ | 0.18 | 0.09 | 2.08 | [0.01,0.36] | 0.038 * | 
| Gender: Male | $\hat{\beta}_3$ | 0.57 | 0.19 | 2.94 | [0.19,0.96] | 0.003 ** | 
| Education | $\hat{\beta}_4$ | 0.36 | 0.18 | 1.96 | [0.0006,0.72] | 0.05 . | 
| Marital: Married | $\hat{\beta}_5$ | 0.22 | 0.21 | 1.06 | [-0.19,0.64] | 0.29 | 
| Marital: Unmarried | $\hat{\beta}_6$ | -0.28 | 0.17 | -1.615 | [-0.62,0.06] | 0.11 | 
| IADL | $\hat{\beta}_7$ | 3.49 | 0.52 | 6.78 | [2.51,4.53] | 1.20e-11 *** | 
| ADL | $\hat{\beta}_8$ | 0.82 | 0.32 | 2.59 | [0.20,1.45] | 0.01 ** | 

McFadden pseudo - $R^2$ to measure how well the model fits:
$pR^2_{MF} = 1-(df_{residual}/df_{null})$ = $1-665.58/882.86 = 0.25$


```{r}
filterCountryData <- function(xyz) { # create a function with the name my_function
  test<-dat%>%
    filter(Country==xyz)%>%
  return(test)
}
digital_proxyUS <- filterCountryData("US")
digital_proxySG <- filterCountryData("SG")

# Provides min, median, mean, max, and quartiles
summary(digital_proxyUS$Age)
# Standard deviation of Age
sd(digital_proxyUS$Age)

table(test.data.us$Age)
percentage_age_us<-prop.table(table(test.data.us$Age)) * 100 

# Percentage of each category in Income
prop.table(table(test.data.us$Income)) * 100 
median(test.data.us$Income)

# Percentage of each category in Gender
prop.table(table(test.data.us$Gender)) * 100  

# Percentage of each category in Education
prop.table(table(test.data.us$Education)) * 100  
median(test.data.us$Income)

# Percentage of each category in Marital
prop.table(table(test.data.us$Marital)) * 100  

# summary of IADL
summary(test.data.us$IADL)
sd(test.data.us$IADL)

# summary of ADL
summary(test.data.us$ADL)
sd(test.data.us$ADL)
```

* Descriptive statistics:
  + Age (numerical)
    - mean: 44.88
    - median: 45.00
    - Interquartile Range (IQR): 1st Qu. 30.00, 3rd Qu. 60.00
    - standard deviation: 15.60581
    - Percentage: 21 (8.523592%), 25 (7.153729%), 30 (11.719939%), 35 (9.589041%), 40 (9.436834%), 45 (9.893455%), 50 (8.523592%), 55 (7.458143%), 60 (8.523592%), 65 (9.589041%), 70 (9.589041)
  + Income (ordinal) 
    - Percentage: <$30k (29.375951%), $30k (22.831050%), $50k (29.984779%), $100k (11.263318%), $150k (4.261796%), >$200k (2.283105%)
    - median: $30k
  + Gender (binary)
    - Percentage: Female (50.53272%), Male (49.46728%)
  + Education (ordinal)
    - Percentage: < High School (4.261796%), High School (50.076104%), Degree and above (45.662100%)
    - median: High School
  + Marital
    - Percentage: Unmarried (39.87823%), Married (40.48706%), Once Married (19.63470%)
  + IADL (numerical)
    - mean: 0.5917
    - median: 0.7100
    - Interquartile Range (IQR): 1st Qu. 0.3800, 3rd Qu. 0.8300
    - standard deviation: 0.3203752
  + ADL (numerical)
    - mean: 0.4393
    - median: 0.4200
    - Interquartile Range (IQR): 1st Qu. 0.0000, 3rd Qu. 0.8300
    - standard deviation: 0.3970749

        



```{r}
#########-----------_medicalDigitalDelegation START HERE-----------------
#Assist vs. No
test.data.us$MedicalDelegate1 = factor(test.data.us$MedicalDelegate1,
                                    levels = c("Assist","No"),
                                    labels = c("1","0"))
test.data.us$MedicalDelegate1 <- as.numeric(as.character(test.data.us$MedicalDelegate1))

modelMedLevel1 <- glm(MedicalDelegate1 ~ . - lowstakeMed - highstakeMed
                      - FinanceDelegate1 - FinanceDelegate2
                      - MedicalDelegate2,
                      family=binomial, data=test.data.us)

summary(modelMedLevel1)
modelMedLevel1_new <- stepAIC(modelMedLevel1)
summary(modelMedLevel1_new$fitted.values)
summary(modelMedLevel1_new)

confint(modelMedLevel1_new,level = 0.95)
confint.default(modelMedLevel1_new)
```

\newpage

# US Medical model

Variable | Coefficient | Estimate | Standard Error | z-value | 95% CI | p-value |
| --- | --- | --- | --- | --- | --- | --- | 
|(Intercept) | $\hat{\beta}_0$ | -3.68 | 0.86 | -4.26 | [-5.40,-2.01] | 2.02e-05 *** | 
| Age | $\hat{\beta}_1$ | -0.13 | 0.04 | -3.36 | [-0.22,-0.05] | 0.001 *** | 
| Gender: Male | $\hat{\beta}_2$ | 0.61 | 0.20 | 3.03 | [0.22,1.01] | 0.002 ** | 
| Education | $\hat{\beta}_3$ | 0.42 | 0.18 | 2.30 | [0.06,0.78] | 0.02 * | 
| Employment: Unemployed | $\hat{\beta}_4$ | -0.34 | 0.22 | -1.56 | [-0.78,0.09] | 0.12 | 
| Ethnicity: Underrepresented | $\hat{\beta}_5$ | -0.47 | 0.22 | -2.12 | [-0.90,-0.04] | 0.034 * | 
| Siblings | $\hat{\beta}_6$ | 0.22 | 0.08 | 2.84 | [0.07,0.37] | 0.0045 ** | 
| Marital: Married | $\hat{\beta}_7$ | 0.32 | 0.22 | 1.47 | [-0.11,0.76] | 0.14 | 
| Marital: Unmarried | $\hat{\beta}_8$ | -0.29 | 0.17 | -1.72 | [-0.63,0.04] | 0.086 . | 
| IADL | $\hat{\beta}_9$ | 2.69 | 0.53 | 5.13 | [1.69,3.75] | 2.86e-07 *** | 
| ADL | $\hat{\beta}_{10}$ | 1.39 | 0.33 | 4.18 | [0.74,2.04] | 2.98e-05 *** | 


McFadden pseudo - $R^2$ to measure how well the model fits:
$pR^2_{MF} = 1-(df_{residual}/df_{null})$ = $1-644.73/870.94=0.26$



```{r}
# Percentage of each category in Employment
prop.table(table(test.data.us$Employment)) * 100 
prop.table(table(digital_proxyUS$Employment)) * 100 

# Percentage of each category in Ethnicity
prop.table(table(test.data.us$Ethnicity)) * 100 
prop.table(table(digital_proxyUS$Ethnicity)) * 100 

# Provides min, median, mean, max, and quartiles
summary(test.data.us$Siblings)
# Standard deviation of Age
sd(test.data.us$Siblings)

```

* Descriptive statistics:
  + Employment (Binary)
    - Percentage: Employed (56.77321%), Unemployed (43.22679%)
    - Percentage (Original Dataset): Disabled (2.9629630%), Full-time (42.9629630%), Part-time (13.1851852%), Retired (21.0370370%), Self (1.1851852%), Student (0.5925926%), Unemployed (18.0740741%)
  + Ethnicity (categorical) 
    - Percentage: Majority (63.62253%), Underrepresented (36.37747%)
    - Percentage (Original Dataset): Asian (5.629630%), Black (16.740741%), His/Lat (6.222222%), Mixed (5.925926%), Native (1.185185%), Others (1.037037%), White (63.259259%)
  + Siblings (numerical)
    - mean: 3.038
    - median: 3.038
    - Interquartile Range (IQR): 1st Qu. 2.000, 3rd Qu. 4.000
    - standard deviation: 1.324056


\newpage

# SG data on US model

```{r}
sg_filtered_data <- country_data(filtered.dat, "US")

sg_filtered_data <- subset(sg_filtered_data, !(HelpFriends=="101"))
sg_filtered_data <- subset(sg_filtered_data, !(FinanceHelpFriends=="101"))
sg_filtered_data <- subset(sg_filtered_data, !(MedicalHelpImmediateFam=="101"))
sg_filtered_data <- subset(sg_filtered_data, !(MedicalHelpFriends=="101"))

sg_filtered_data <- subset(sg_filtered_data, !(HelpFriends=="31"))
sg_filtered_data <- subset(sg_filtered_data, !(FinanceHelpFriends=="31"))
sg_filtered_data <- subset(sg_filtered_data, !(MedicalHelpImmediateFam=="31"))
sg_filtered_data <- subset(sg_filtered_data, !(MedicalHelpFriends=="31"))
sg_filtered_data <- subset(sg_filtered_data, !(FinanceJointAccount=="Exclude"))
sg_filtered_data <- subset(sg_filtered_data, !(Marital=="3"))

# Create test dataframe with only demographic predictors
test.data.sg = sg_filtered_data[,c('Age','Income','Housing','Gender','Education','Religion','Employment','Ethnicity',
                            'Siblings','Marital')]

#how much help participants have provided for an adult in carrying out their instrumental activities of daily living
test.data.sg$IADL = rowSums(sg_filtered_data[ , c("HelpTransport","HelpMed","HelpFinance","HelpFood","HelpLaundry","HelpHousekeep")])
test.data.sg$IADL <- scale_values(test.data.sg$IADL)
test.data.sg$IADL <- round(test.data.sg$IADL ,digit=2)

#how much help participants have provided for an adult in carrying out their activities of daily living
test.data.sg$ADL = rowSums(sg_filtered_data[ , c("ADLBath","ADLFeed","ADLGroom","ADLIncontinence","ADLToilet","ADLTransfer")]) 
test.data.sg$ADL <- scale_values(test.data.sg$ADL)
test.data.sg$ADL <- round(test.data.sg$ADL ,digit=2)

#how much help participants have provided for an adult in carrying out low-stake medical care activities
test.data.sg$lowstakeMed = rowSums(sg_filtered_data[ , c("MedicalMakeAppt","MedicalAccompanyAppt","MedicalTakeMeds","MedicalSeeTreatment")])

#how much help participants have provided for an adult in carrying out high-stake medical care activities
test.data.sg$highstakeMed = rowSums(sg_filtered_data[ , c("MedicalDecisionPerson","MedicalDecisionDoctor","MedicalSignPapers","MedicalWorthPerson",
                                                   "MedicalWorthDoctor","MedicalWorthFamily","MedicalEndPerson","MedicalEndFamily",
                                                   "MedicalFlexibilityPerson","MedicalFlexibilityDoctor","MedicalFlexibilityFamily",
                                                   "MedicalDoctorQuestions")])

#DEPENDENT VARIABLES HERE
test.data.sg$FinanceDelegate1 = as.factor(sg_filtered_data$FinanceDelegate1)
test.data.sg$FinanceDelegate2 = as.factor(sg_filtered_data$FinanceDelegate2)
test.data.sg$MedicalDelegate1 = as.factor(sg_filtered_data$MedicalDelegate1)
test.data.sg$MedicalDelegate2 = as.factor(sg_filtered_data$MedicalDelegate2)
```


# SG data on US financial model

```{r}
modelFinLevel2 <- glm(FinanceDelegate1 ~ Age + Income + Gender + Education + Marital + IADL + ADL, data=test.data.sg, family = "binomial")

summary(modelFinLevel2$fitted.values)
summary(modelFinLevel2)

confint(modelFinLevel2,level = 0.95)
confint.default(modelFinLevel2)
```
\newpage
# SG data on US financial model

Variable | Coefficient | Estimate | Standard Error | z-value | 95% CI | p-value |
| --- | --- | --- | --- | --- | --- | --- | 
|(Intercept) | $\hat{\beta}_0$ | -3.03 | 1.06 | -2.85 | [-5.16,-0.98] | 0.004 ** | 
| Age | $\hat{\beta}_1$ | -0.25 | 0.06 | -4.03 | [-0.38,-0.13] | 5.48e-05 *** | 
| Income | $\hat{\beta}_2$ | 0.026 | 0.12 | 0.23 | [-0.20,0.26] | 0.82 | 
| Gender: Male | $\hat{\beta}_3$ | 0.31 | 0.28 | 1.09 | [-0.25,0.86] | 0.28 | 
| Education | $\hat{\beta}_4$ | 0.67 | 0.33 | 2.05 | [0.04,1.33] | 0.04 * | 
| Marital: Married | $\hat{\beta}_5$ | 0.73 | 0.47 | 1.55 | [-0.21,1.66] | 0.12 | 
| Marital: Unmarried | $\hat{\beta}_6$ | -0.018 | 0.31 | -0.058 | [-0.64,0.58] | 0.95 | 
| IADL | $\hat{\beta}_7$ | 2.87 | 0.74 | 3.90 | [1.46,4.36] | 9.66e-05 *** | 
| ADL | $\hat{\beta}_8$ | 0.89 | 0.51 | 1.73 | [-0.11,1.90] | 0.08 . | 

McFadden pseudo - $R^2$ to measure how well the model fits:
$pR^2_{MF} = 1-(df_{residual}/df_{null})$ = $1-305.43/413.82 = 0.26$


## SG data on US Medical model

```{r}
modelMedLevel2 <- glm(MedicalDelegate1 ~ Age + Gender + Education + Employment + Siblings + Ethnicity + Marital + IADL + ADL,
                      family=binomial, data=test.data.sg)

summary(modelMedLevel2$fitted.values)
summary(modelMedLevel2)

confint(modelMedLevel2,level = 0.95)
confint.default(modelMedLevel2)
```
\newpage

## SG data on US Medical model

Variable | Coefficient | Estimate | Standard Error | z-value | 95% CI | p-value |
| --- | --- | --- | --- | --- | --- | --- | 
|(Intercept) | $\hat{\beta}_0$ | -2.47 | 1.53 | -1.62 | [-5.48,0.53] | 0.11 | 
| Age | $\hat{\beta}_1$ | -0.25 | 0.06 | -3.89 | [-0.37,-0.12] | 0.0001 *** | 
| Gender: Male | $\hat{\beta}_2$ | 0.24 | 0.28 | 0.85 | [-0.32,0.80] | 0.40 | 
| Education | $\hat{\beta}_3$ | 0.21 | 0.32 | 0.67 | [-0.41,0.83] | 0.51 | 
| Employment: Unemployed | $\hat{\beta}_4$ | -0.30 | 0.44 | -0.68 | [-1.19,0.54] | 0.50 | 
| Ethnicity: Underrepresented | $\hat{\beta}_5$ | 0.79 | 0.36 | 2.21 | [0.1,1.50] | 0.03 * | 
| Siblings | $\hat{\beta}_6$ | 0.057 | 0.12 | 0.47 | [-0.18,0.30] | 0.64 | 
| Marital: Married | $\hat{\beta}_7$ | 0.53 | 0.467 | 1.14 | [-0.40,1.44] | 0.25 | 
| Marital: Unmarried | $\hat{\beta}_8$ | -0.34 | 0.29 | -1.18 | [-0.93,0.22] | 0.24 | 
| IADL | $\hat{\beta}_9$ | 2.68 | 0.72 | 3.75 | [1.31,4.13] | 0.0002 *** | 
| ADL | $\hat{\beta}_{10}$ | 0.73 | 0.49 | 1.48 | [-0.23,1.70] | 0.14 | 


McFadden pseudo - $R^2$ to measure how well the model fits:
$pR^2_{MF} = 1-(df_{residual}/df_{null})$ = $1-318.47/412.49=0.23$


```{r}
# Percentage of each category in Gender
prop.table(table(test.data.sg$Gender)) * 100 

# Percentage of each category in Employment
prop.table(table(test.data.sg$Employment)) * 100 
prop.table(table(digital_proxySG$Employment)) * 100 

# Provides min, median, mean, max, and quartiles
summary(test.data.sg$Siblings)
# Standard deviation of Age
sd(test.data.sg$Siblings)

```

* Descriptive statistics:
  + Gender (Binary)
    - Percentage: Female (46.7105263%), Male (52.9605263%)
  + Employment (Binary)
    - Percentage: Employed (85.52632%), Unemployed (14.47368%)
    - Percentage (Original Dataset): Full-time (72.347267%), Part-time (11.897106%), Retired (5.144695%), Self (1.607717%), Student (2.250804%), Unemployed (6.752412%)
  + Siblings (numerical)
    - mean: 3.191
    - median: 3.000
    - Interquartile Range (IQR): 1st Qu. 2.000, 3rd Qu. 4.000
    - standard deviation: 1.288351


\newpage

# SG model

```{r}
#########-----------_financialDigitalDelegation START HERE-----------------
#Assist vs. No
test.data.sg$FinanceDelegate1 = factor(test.data.sg$FinanceDelegate1,
                                    levels = c("Assist","No"),
                                    labels = c("1","0"))
test.data.sg$FinanceDelegate1 <- as.numeric(as.character(test.data.sg$FinanceDelegate1))

modelFinLevel3 <- glm(FinanceDelegate1 ~ . - lowstakeMed - highstakeMed
                      - MedicalDelegate1 - MedicalDelegate2
                      - FinanceDelegate2, data=test.data.sg, family = "binomial")

summary(modelFinLevel3)
modelFinLevel3_new <- stepAIC(modelFinLevel3)
summary(modelFinLevel3_new$fitted.values)
summary(modelFinLevel3_new)

confint(modelFinLevel3_new,level = 0.95)
confint.default(modelFinLevel3_new)

```

\newpage

## SG financial model

Variable | Coefficient | Estimate | Standard Error | z-value | 95% CI | p-value |
| --- | --- | --- | --- | --- | --- | --- | 
|(Intercept) | $\hat{\beta}_0$ | -4.30 | 1.23 | -3.49 | [-6.78,-1.94] | 0.0005 *** | 
| Age | $\hat{\beta}_1$ | -0.20 | 0.05 | -3.61 | [-0.30,-0.09] | 0.0003 *** | 
| Education | $\hat{\beta}_2$ | 0.88 | 0.32 | 2.78 | [0.27,1.51] | 0.005 ** |  
| Ethnicity: Underrepresented | $\hat{\beta}_3$ | 0.74 | 0.37 | 2.02 | [0.029,1.48] | 0.04 * | 
| IADL | $\hat{\beta}_4$ | 2.77 | 0.73 | 3.80 | [1.37,4.24] | 0.0001 *** | 
| ADL | $\hat{\beta}_5$ | 0.88 | 0.51 | 1.74 | [-0.11,1.89] | 0.081 . | 


McFadden pseudo - $R^2$ to measure how well the model fits:
$pR^2_{MF} = 1-(df_{residual}/df_{null})$ = $1-305.92/413.82=0.26$


# SG financial model with Religion

Variable | Coefficient | Estimate | Standard Error | z-value | 95% CI | p-value |
| --- | --- | --- | --- | --- | --- | --- | 
|(Intercept) | $\hat{\beta}_0$ | -3.28 | 1.10 | -2.99 | [-5.50,-1.18] | 0.003 ** | 
| Age | $\hat{\beta}_1$ | -0.20 | 0.06 | -3.50 | [-0.32,-0.09] | 0.0005 *** | 
| Education | $\hat{\beta}_2$ | 0.86 | 0.34 | 2.56 | [0.21,1.54] | 0.01 * | 
| Religion: Catholicism | $\hat{\beta}_3$ | 1.25 | 0.77 | 1.62 | [-0.23,2.80] | 0.10 | 
| Religion: Christianity | $\hat{\beta}_4$ | -0.51 |0.41 | -1.26 | [-1.32,0.28] | 0.21 | 
| Religion: Hinduism | $\hat{\beta}_5$ | 0.49 | 0.76 | 0.64 | [-1.08,1.98] | 0.52 | 
| Religion: Islam | $\hat{\beta}_6$ | 0.38 | 0.48 | 0.80 | [-0.55,1.32] | 0.43 | 
| Religion: No Religion | $\hat{\beta}_7$ | -0.86 | 0.42 | -2.05 | [-1.70,-0.05] | 0.04 * | 
| Religion: Taoism | $\hat{\beta}_8$ | -1.81 | 1.02 | -1.78 | [-4.04,0.07] | 0.08 . | 
| IADL | $\hat{\beta}_9$ | 3.03 | 0.77 | 3.93 | [1.56,4.60] | 8.57e-05 *** | 
| ADL | $\hat{\beta}_10$ | 0.86 | 0.52 | 1.65 | [-0.16,1.90] | 0.10 . | 


McFadden pseudo - $R^2$ to measure how well the model fits:
$pR^2_{MF} = 1-(df_{residual}/df_{null})$ = $1-294.59/413.82=0.29$


```{r}
# Provides min, median, mean, max, and quartiles
summary(digital_proxySG$Age)
# Standard deviation of Age
sd(digital_proxySG$Age)

# Percentage of each category in Education
table(test.data.us$Education)
table(test.data.sg$Education)
prop.table(table(test.data.sg$Education)) * 100  
median(test.data.sg$Income)

# Percentage of each category in Religion
prop.table(table(test.data.sg$Religion)) * 100  

# Percentage of each category in Ethnicity
prop.table(table(test.data.sg$Ethnicity)) * 100
prop.table(table(digital_proxySG$Ethnicity)) * 100 

# summary of IADL
summary(test.data.sg$IADL)
sd(test.data.sg$IADL)

# summary of ADL
summary(test.data.sg$ADL)
sd(test.data.sg$ADL)
```

* Descriptive statistics:
  + Age (numerical)
    - mean: 41.86
    - median: 40.00
    - Interquartile Range (IQR): 1st Qu. 30.00, 3rd Qu. 55.00
    - standard deviation: 13.73793
  + Education (ordinal)
    - Percentage: < High School (2.302632%), High School (39.473684%), Degree and above (58.223684%)
    - median: Degree and above
  + Ethnicity (categorical) 
    - Percentage: Majority (78.94737%), Underrepresented (21.05263%)
    - Percentage (Original Dataset): Chinese (78.4565916%), Eurasian (1.9292605%), Indian (4.8231511%), Malay (12.2186495%), Mixed (0.6430868%), Others (1.9292605%)
  + IADL (numerical)
    - mean: 0.5076
    - median: 0.5400
    - Interquartile Range (IQR): 1st Qu. 0.2900, 3rd Qu. 0.7500
    - standard deviation: 0.2937254
  + ADL (numerical)
    - mean: 0.3363
    - median: 0.1900
    - Interquartile Range (IQR): 1st Qu. 0.0000, 3rd Qu. 0.6700
    - standard deviation: 0.3666648
  + Religion(categorical)
    - Percentage: Buddhist (34.539474%), Catholicism (4.605263%), Christianity (19.407895), Hinduism (3.289474%), Islam (14.473684%), No Religion (19.736842%), Taoism (3.947368%)
    - A total of 303 participants



```{r}
#########-----------_medicalDigitalDelegation START HERE-----------------
#Assist vs. No
test.data.sg$MedicalDelegate1 = factor(test.data.sg$MedicalDelegate1,
                                    levels = c("Assist","No"),
                                    labels = c("1","0"))
test.data.sg$MedicalDelegate1 <- as.numeric(as.character(test.data.sg$MedicalDelegate1))

modelMedLevel3 <- glm(MedicalDelegate1 ~ . - lowstakeMed - highstakeMed
                      - FinanceDelegate1 - FinanceDelegate2
                      - MedicalDelegate2,
                      family=binomial, data=test.data.sg)

summary(modelMedLevel3)
modelMedLevel3_new <- stepAIC(modelMedLevel3)
summary(modelMedLevel3_new$fitted.values)
summary(modelMedLevel3_new)

confint(modelMedLevel3_new,level = 0.95)
confint.default(modelMedLevel3_new)
```

\newpage

# SG Medical model

Variable | Coefficient | Estimate | Standard Error | z-value | 95% CI | p-value |
| --- | --- | --- | --- | --- | --- | --- | 
|(Intercept) | $\hat{\beta}_0$ | -3.39 | 0.97 | -3.50 | [-5.33,-1.52] | 0.0005 *** | 
| Age | $\hat{\beta}_1$ | -0.26 | 0.06 | -4.33 | [-0.38,-0.14] | 1.51e-05 *** | 
| Income | $\hat{\beta}_2$ | 0.18 | 0.11 | 1.57 | [-0.04,0.40] | 0.12 | 
| Housing | $\hat{\beta}_3$ | 0.54 | 0.34 | 1.62 | [-0.11,1.22] | 0.10 | 
| Ethnicity: Underrepresented | $\hat{\beta}_4$ | 0.90 | 0.35 | 2.55 | [0.21,1.61] | 0.01 * | 
| Marital: Married | $\hat{\beta}_5$ | 0.60 | 0.46 | 1.31 | [-0.32,1.50] | 0.19 | 
| Marital: Unmarried | $\hat{\beta}_6$ | -0.18 | 0.30 | -0.58 | [-0.79,0.41] | 0.56 | 
| IADL | $\hat{\beta}_7$ | 2.54 | 0.72 | 3.54 | [1.16,3.98] | 0.0004 *** | 
| ADL | $\hat{\beta}_8$ | 0.85 | 0.50 | 1.69 | [-0.13,1.85] | 0.09 . | 


McFadden pseudo - $R^2$ to measure how well the model fits:
$pR^2_{MF} = 1-(df_{residual}/df_{null})$ = $1-313.24/412.49=0.24$


# SG Medical model with Religion (same as the model without Religion)

Variable | Coefficient | Estimate | Standard Error | z-value | 95% CI | p-value |
| --- | --- | --- | --- | --- | --- | --- | 
|(Intercept) | $\hat{\beta}_0$ | -3.39 | 0.97 | -3.50 | [-5.33,-1.52] | 0.0005 *** | 
| Age | $\hat{\beta}_1$ | -0.26 | 0.06 | -4.33 | [-0.38,-0.14] | 1.51e-05 *** | 
| Income | $\hat{\beta}_2$ | 0.18 | 0.11 | 1.57 | [-0.04,0.40] | 0.12 | 
| Housing | $\hat{\beta}_3$ | 0.54 | 0.34 | 1.62 | [-0.11,1.22] | 0.10 | 
| Ethnicity: Underrepresented | $\hat{\beta}_4$ | 0.90 | 0.35 | 2.55 | [0.21,1.61] | 0.01 * | 
| Marital: Married | $\hat{\beta}_5$ | 0.60 | 0.46 | 1.31 | [-0.32,1.50] | 0.19 | 
| Marital: Unmarried | $\hat{\beta}_6$ | -0.18 | 0.30 | -0.58 | [-0.79,0.41] | 0.56 | 
| IADL | $\hat{\beta}_7$ | 2.54 | 0.72 | 3.54 | [1.16,3.98] | 0.0004 *** | 
| ADL | $\hat{\beta}_8$ | 0.85 | 0.50 | 1.69 | [-0.13,1.85] | 0.09 . | 


McFadden pseudo - $R^2$ to measure how well the model fits:
$pR^2_{MF} = 1-(df_{residual}/df_{null})$ = $1-313.24/412.49=0.24$





```{r}
# Percentage of each category in Income
prop.table(table(test.data.sg$Income)) * 100 
median(test.data.sg$Income)

# Percentage of each category in Housing
prop.table(table(test.data.sg$Housing)) * 100  

# Percentage of each category in Marital
prop.table(table(test.data.sg$Marital)) * 100 
```


* Descriptive statistics:
  + Income (ordinal) 
    - Percentage: <$30k (18.421053%), $30k (13.486842%), $50k (28.618421%), $100k (24.013158%), $150k (9.539474%), >$200k (5.921053%)
    - median: $50k
  + Housing (categorical)
    - Percentage: low-income housing (4.276316%), apartment (78.618421%), familyhouse (17.105263%)
  + Marital
    - Percentage: Unmarried (36.513158%), Married (56.578947%), Once Married (6.907895%)
    
    



```{r}
prop.table(table(test.data.us$Age)) * 100 
prop.table(table(test.data.sg$Age)) * 100 

df <- data.frame(
  Age = rep(c("21","25", "30", "35", "40", "45", "50", "55", "60", "65", "70"), each = 2),
  Percentage = c(8.523592, 10.1973684, 7.153729, 9.5394737, 11.719939, 11.8421053, 9.589041, 10.1973684, 9.436834, 8.2236842, 9.893455, 10.8552632, 8.523592, 8.2236842, 7.458143, 14.8026316, 8.523592, 11.8421053, 9.589041, 3.2894737, 9.589041, 0.9868421), 
  Country = rep(c("US", "SG"), 11)
)

library(ggplot2)

# Plot
p <- ggplot(df, aes(x = as.numeric(Age), y = Percentage, color = Country)) +
  geom_bar(aes(fill = Country), stat = "identity", position = position_dodge()) +
  geom_smooth(method = "lm", se = FALSE, position = position_dodge(width = 0.2)) + # trend lines
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  scale_color_manual(values = c("US" = "blue", "SG" = "green")) +  # colors for trend lines
  geom_text(aes(label = sprintf("%.2f", Percentage), group = Country), vjust = -0.5, position = position_dodge(0.9)) +
  theme_minimal() +
  labs(title = "Percentage Distribution Across Country",
       x = "Age Level",
       y = "Percentage (%)")
# Print the plot
print(p)
```

# Plots for common predictors between US and SG for Financial model

## Age
```{r}
# # Add the fitted probabilities to dataset
# test.data.us$FittedProbabilities <- modelFinLevel1_new$fitted.values
# test.data.sg$FittedProbabilities <- modelFinLevel3_new$fitted.values
# 
# # Aggregate the fitted probabilities by age
# Fitted_sum_us <- aggregate(FittedProbabilities ~ Age, data = test.data.us, mean)
# Fitted_sum_sg <- aggregate(FittedProbabilities ~ Age, data = test.data.sg, mean)
# 
# # Convert to a percentage
# Fitted_sum_us$Proportion <- Fitted_sum_us$FittedProbabilities * 100
# Fitted_sum_sg$Proportion <- Fitted_sum_sg$FittedProbabilities * 100
# 
# Fitted_sum_us$Country <- 'US'
# Fitted_sum_sg$Country <- 'SG'
# 
# combined_data <- rbind(Fitted_sum_us, Fitted_sum_sg)
# 
# 
# p <- ggplot(combined_data, aes(x = Age, y = Proportion, group = Country)) +
#   geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
#   scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
#   geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
#   geom_text(aes(label = sprintf("%.1f%%", Proportion), fill = Country),
#             position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
#   scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
#   theme_minimal() +
#   labs(title = "Financial Delegation by Age",
#        x = "Age",
#        y = "Percentage of Financial Delegation") +
#   guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))
# 
# print(p)
```

```{r}
# Calculate the total number of individuals in each age level
# group data by the Age
# For each group, applies the length function to the FinanceDelegate1 column, which counts the number of FinanceDelegate1 for each Age
Age_count_us <- aggregate(FinanceDelegate1 ~ Age, data = test.data.us, length)
sum_age_us <- sum (table(test.data.us$Age))
Age_count_sg <- aggregate(FinanceDelegate1 ~ Age, data = test.data.sg, length)
sum_age_sg <- sum (table(test.data.sg$Age))

# Calculate the proportion of financial delegation as a percentage
Age_count_us$Proportion <- Age_count_us$FinanceDelegate1 / sum_age_us * 100
Age_count_sg$Proportion <- Age_count_sg$FinanceDelegate1 / sum_age_sg * 100

Age_count_us$Country <- 'US'
Age_count_sg$Country <- 'SG'

combined_data <- rbind(Age_count_us, Age_count_sg)

p <- ggplot(combined_data, aes(x = Age, y = Proportion, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Proportion), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Financial Delegation by Age",
       x = "Age",
       y = "Percentage of Financial Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```

ordering <- c("21","25", "30", "35", "40", "45", "50", "55", "60", "65", "70")

This plot shows the trend of the percentage of financial delegation as age growth and how individuals' percentage to delegate financial decisions differs in the US and SG. 
Both the green trend line (SG) and the blue trend line (US) exhibit a decrease in the likelihood of financial delegation as age grows, which shows a negative correlation between the age of participants and the percentage of medical delegation. For SG participants, the highest percentage in helping with financial delegation occurs from age 35-39 with 65.4% and the lowest percentage in helping with financial delegation occurs for age over 70 with 15.6%. For US participants, the highest percentage in helping with financial delegation occurs from age 30-34 with 51.2% and the lowest percentage in helping with financial delegation occurs from age 65-69 with 26.2%. 
Moreover, the percentage of financial delegation is higher in SG when participants have an age lower than 45 years old, once the age exceeds 45 years old, the percentage of financial delegation is higher in the US.


## Education

```{r}
# Calculate the total number of individuals in each education level
# group data by the Education
# For each group, applies the length function to the FinanceDelegate1 column, which counts the number of FinanceDelegate1 for each Education group
Education_count_us <- aggregate(FinanceDelegate1 ~ Education, data = test.data.us, length)
sum_education_us <- sum (table(test.data.us$Education))
Education_count_sg <- aggregate(FinanceDelegate1 ~ Education, data = test.data.sg, length)
sum_education_sg <- sum (table(test.data.sg$Education))

# Calculate the proportion of financial delegation as a percentage
Education_count_us$Proportion <- Education_count_us$FinanceDelegate1 / sum_education_us * 100
Education_count_sg$Proportion <- Education_count_sg$FinanceDelegate1 / sum_education_sg * 100

Education_count_us$Country <- 'US'
Education_count_sg$Country <- 'SG'

combined_data <- rbind(Education_count_us, Education_count_sg)

combined_data$Education <- factor(combined_data$Education, 
                                  levels = c(1, 2, 3),
                                  labels = c("< High School", "High School", "Degree and above"))

p <- ggplot(combined_data, aes(x = Education, y = Proportion, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Proportion), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Financial Delegation by Education",
       x = "Education",
       y = "Percentage of Financial Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)


```

The green trend line represents the likelihood of financial delegating decisions that differ among Education levels for SG participants. The blue trend line represents the likelihood of financial delegating decisions that differ among Education levels for US participants. Both countries have an increasing trend, which means that the participant who has a higher education level (degree and above) might have a higher probability of helping with financial delegations. For education levels lower than high school, US participants have a higher percentage of helping with financial delegations about 4.3%. However, for participants who have a degree and above, SG participants have a higher percentage of helping with the financial delegation about 58.2%.


## IADL

```{r}
# Aggregate financial delegation by IADL score
# group the FinanceDelegate1 data by the IADL variable
# function sums up the FinanceDelegate1 values within each IADL group.
IADL_delegation_us <- aggregate(FinanceDelegate1 ~ IADL, data = test.data.us, FUN = function(x) { sum(x) })
IADL_delegation_sg <- aggregate(FinanceDelegate1 ~ IADL, data = test.data.sg, FUN = function(x) { sum(x) })

# Calculate the total count
total_delegation_us <- sum(IADL_delegation_us$FinanceDelegate1)
total_delegation_sg <- sum(IADL_delegation_sg$FinanceDelegate1)

# Calculate the proportion
IADL_delegation_us$Proportion <- (IADL_delegation_us$FinanceDelegate1 / total_delegation_us) * 100
IADL_delegation_sg$Proportion <- (IADL_delegation_sg$FinanceDelegate1 / total_delegation_sg) * 100

IADL_delegation_us$Country <- 'US'
IADL_delegation_sg$Country <- 'SG'

combined_data <- rbind(IADL_delegation_us, IADL_delegation_sg)


p <- ggplot(combined_data, aes(x = as.factor(IADL), y = Proportion, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Proportion), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Financial Delegation by IADL",
       x = "IADL",
       y = "Percentage of Financial Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```


This plot shows that based on the Instrumental Activities of Daily Living (IADL) with a range [0,1], how individuals' percentage to delegate financial decisions differ in US and SG. 
Both the green trend line (SG) and the blue trend line (US) exhibit an increase in the likelihood of financial delegation as IADL scores increase, which shows a positive correlation between IADL scores and the percentage of medical delegation.
Moreover, with the same IADL score, the Percentage of financial Delegation is higher in SG compared with the US.



## ADL
```{r}
# Aggregate financial delegation by IADL score
ADL_delegation_us <- aggregate(FinanceDelegate1 ~ ADL, data = test.data.us, FUN = function(x) { sum(x) })
ADL_delegation_sg <- aggregate(FinanceDelegate1 ~ ADL, data = test.data.sg, FUN = function(x) { sum(x) })

# Calculate the total count
total_delegation_us <- sum(ADL_delegation_us$FinanceDelegate1)
total_delegation_sg <- sum(ADL_delegation_sg$FinanceDelegate1)

# Calculate the proportion
ADL_delegation_us$Proportion <- (ADL_delegation_us$FinanceDelegate1 / total_delegation_us) * 100
ADL_delegation_sg$Proportion <- (ADL_delegation_sg$FinanceDelegate1 / total_delegation_sg) * 100

ADL_delegation_us$Country <- 'US'
ADL_delegation_sg$Country <- 'SG'

combined_data <- rbind(ADL_delegation_us, ADL_delegation_sg)

p <- ggplot(combined_data, aes(x = as.factor(ADL), y = Proportion, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Proportion), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Financial Delegation by IADL",
       x = "IADL",
       y = "Percentage of Financial Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```


This plot shows that based on the Activities of Daily Living (ADL) with a range [0,1], how is individuals percentage to delegate financial decisions differ in US and SG. 
Both the green trend line (SG) and the blue trend line (US) exhibit an increase in the likelihood of financial delegation as ADL scores increase, which shows a positive correlation between ADL scores and the percentage of financial delegation.
Moreover, with the same ADL score, the Percentage of financial Delegation is higher in SG compared with US. 



\newpage

# Plots for common predictors between US and SG for Medical model

## Age

```{r}
# # Add the fitted probabilities to your dataset
# test.data.us$FittedProbabilities <- modelMedLevel1_new$fitted.values
# test.data.sg$FittedProbabilities <- modelMedLevel3_new$fitted.values
# 
# # Aggregate the fitted probabilities by age
# Fitted_sum_us <- aggregate(FittedProbabilities ~ Age, data = test.data.us, mean)
# Fitted_sum_sg <- aggregate(FittedProbabilities ~ Age, data = test.data.sg, mean)
# 
# # Convert to a percentage
# Fitted_sum_us$Proportion <- Fitted_sum_us$FittedProbabilities * 100
# Fitted_sum_sg$Proportion <- Fitted_sum_sg$FittedProbabilities * 100
# 
# Fitted_sum_us$Country <- 'US'
# Fitted_sum_sg$Country <- 'SG'
# 
# combined_data <- rbind(Age_count_us, Age_count_sg)
# 
# 
# p <- ggplot(combined_data, aes(x = Age, y = Proportion, group = Country)) +
#   geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
#   scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
#   geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
#   geom_text(aes(label = sprintf("%.1f%%", Proportion), fill = Country),
#             position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
#   scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
#   theme_minimal() +
#   labs(title = "Financial Delegation by Age",
#        x = "Age",
#        y = "Percentage of Financial Delegation") +
#   guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))
# 
# print(p)
```

```{r}
# Calculate the total number of individuals
Age_count_us <- aggregate(MedicalDelegate1 ~ Age, data = test.data.us, length)
sum_age_us <- sum (table(test.data.us$Age))
Age_count_sg <- aggregate(MedicalDelegate1 ~ Age, data = test.data.sg, length)
sum_age_sg <- sum (table(test.data.sg$Age))

# Calculate the proportion of financial delegation as a percentage
Age_count_us$Proportion <- Age_count_us$MedicalDelegate1 / sum_age_us * 100
Age_count_sg$Proportion <- Age_count_sg$MedicalDelegate1 / sum_age_sg * 100

Age_count_us$Country <- 'US'
Age_count_sg$Country <- 'SG'

combined_data <- rbind(Age_count_us, Age_count_sg)

p <- ggplot(combined_data, aes(x = Age, y = Proportion, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Proportion), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Financial Delegation by Age",
       x = "Age",
       y = "Percentage of Financial Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```

This plot shows the trend of the percentage of medical delegation as age grows and how individuals' percentage to delegate medical decisions differs in the US and SG. 
Both the green trend line (SG) and the blue trend line (US) exhibit a decrease in the likelihood of medical delegation as age grows, which shows a negative correlation between the age of participants and the percentage of medical delegation. For SG participants, the highest percentage in helping with medical delegation occurs from age 35-39 with 64.3% and the lowest percentage in helping with medical delegation occurs for age over 70 with 12.7%. For US participants, the highest percentage in helping with medical delegation occurs from age 30-34 with 51.4% and the lowest percentage in helping with medical delegation occurs from age 65-69 with 20.3%. 
Moreover, the percentage of medical delegation is higher in SG when participants have an age lower than 49 years old, once the age exceeds 49 years old, the percentage of medical delegation is higher in the US.




## Ethnicity
```{r}
# fitted probabilities
test.data.us$Prob_MedicalDelegate = modelMedLevel1_new$fitted.values
test.data.sg$Prob_MedicalDelegate = modelMedLevel3_new$fitted.values

# aggregate Ethnicity for US and SG
Ethnicity_percentage_us <- aggregate(Prob_MedicalDelegate ~ Ethnicity, data = test.data.us, mean)
Ethnicity_percentage_sg <- aggregate(Prob_MedicalDelegate ~ Ethnicity, data = test.data.sg, mean)

# convert probabilities to percentages
Ethnicity_percentage_us$Prob_MedicalDelegate <- Ethnicity_percentage_us$Prob_MedicalDelegate * 100
Ethnicity_percentage_sg$Prob_MedicalDelegate <- Ethnicity_percentage_sg$Prob_MedicalDelegate * 100

Ethnicity_percentage_us$Country <- 'US'
Ethnicity_percentage_sg$Country <- 'SG'
# dataframe
Ethnicity_percentage_us$Ethnicity <- factor(Ethnicity_percentage_us$Ethnicity, 
                                             levels = c(1, 2),
                                             labels = c("Majority", "Underrepresented"))

Ethnicity_percentage_sg$Ethnicity <- factor(Ethnicity_percentage_sg$Ethnicity, 
                                             levels = c(1, 2),
                                             labels = c("Majority", "Underrepresented"))

# Combine the data frames
combined_data <- rbind(Ethnicity_percentage_us, Ethnicity_percentage_sg)

p <- ggplot(combined_data, aes(x = Ethnicity, y = Prob_MedicalDelegate, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Prob_MedicalDelegate), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Medical Delegation by Ethnicity",
       x = "Ethnicity",
       y = "Percentage of Medical Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```

```{r}
# Calculate the total number of individuals
Age_count_us <- aggregate(MedicalDelegate1 ~ Ethnicity, data = test.data.us, length)
sum_age_us <- sum (table(test.data.us$Ethnicity))
Age_count_sg <- aggregate(MedicalDelegate1 ~ Ethnicity, data = test.data.sg, length)
sum_age_sg <- sum (table(test.data.sg$Ethnicity))

# Calculate the proportion of financial delegation as a percentage
Age_count_us$Proportion <- Age_count_us$MedicalDelegate1 / sum_age_us * 100
Age_count_sg$Proportion <- Age_count_sg$MedicalDelegate1 / sum_age_sg * 100

Age_count_us$Country <- 'US'
Age_count_sg$Country <- 'SG'

# dataframe
Age_count_us$Ethnicity <- factor(Age_count_us$Ethnicity, 
                                             levels = c(1, 2),
                                             labels = c("Majority", "Underrepresented"))

Age_count_sg$Ethnicity <- factor(Age_count_sg$Ethnicity, 
                                             levels = c(1, 2),
                                             labels = c("Majority", "Underrepresented"))

combined_data <- rbind(Age_count_us, Age_count_sg)

p <- ggplot(combined_data, aes(x = Ethnicity, y = Proportion, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Proportion), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Financial Delegation by Ethnicity",
       x = "Ethnicity",
       y = "Percentage of Financial Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```



The green trend line represents the likelihood of medical delegating decisions that differ in Ethnicity between the Majority ("Chinese") and Underrepresented ("Malay", "Indian", "Eurasian") for SG participants. It has an increasing trend, which shows that SG participants who have Underrepresented Ethnicity ("Malay", "Indian", "Eurasian") might have a higher percentage of delegating in making medical decisions compared with SG participants whose Ethnicity is "Chinese". 

The blue trend line represents the likelihood of medical delegating decisions that differ in Ethnicity between the Majority ("White") and Underrepresented ("His/Lat", "Black", "Mixed", "Asian", "Others", "Native") for US participants. It has a flat trend, which shows that US participants who have Underrepresented Ethnicity ("His/Lat", "Black", "Mixed", "Asian", "Others", or "Native") might have a similar percentage of delegating in making medical decisions compared with US participants whose Ethnicity is "White". s



## Marital
```{r}
# fitted probabilities
test.data.us$Prob_MedicalDelegate = modelMedLevel1_new$fitted.values
test.data.sg$Prob_MedicalDelegate = modelMedLevel3_new$fitted.values

# aggregate Marital for US and SG
Marital_percentage_us <- aggregate(Prob_MedicalDelegate ~ Marital, data = test.data.us, mean)
Marital_percentage_sg <- aggregate(Prob_MedicalDelegate ~ Marital, data = test.data.sg, mean)

# convert probabilities to percentages
Marital_percentage_us$Prob_MedicalDelegate <- Marital_percentage_us$Prob_MedicalDelegate * 100
Marital_percentage_sg$Prob_MedicalDelegate <- Marital_percentage_sg$Prob_MedicalDelegate * 100

Marital_percentage_us$Country <- 'US'
Marital_percentage_sg$Country <- 'SG'

# Combine the data frames
combined_data <- rbind(Marital_percentage_us, Marital_percentage_sg)

p <- ggplot(combined_data, aes(x = Marital, y = Prob_MedicalDelegate, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Prob_MedicalDelegate), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Medical Delegation by Marital",
       x = "Marital",
       y = "Percentage of Medical Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```

The green trend line represents the likelihood of medical delegating decisions that differ among Marital status for SG participants. It has a decreasing trend, which shows that the unmarried SG participants have the highest percentage of delegating medical decisions about 42.3%, but the once-married SG participants have the lowest percentage of delegating medical decisions about 33.3%. The blue trend line represents the likelihood of medical delegating decisions that differ among Marital status for US participants, which has an increasing trend. It shows that unmarried US participants have the lowest percentage of delegating medical decisions about 33.6%, but the once-married US participants have the highest percentage of delegating medical decisions about 36.4%.


## IADL
```{r}
# fitted probabilities
test.data.us$Prob_MedicalDelegate = modelMedLevel1_new$fitted.values
test.data.sg$Prob_MedicalDelegate = modelMedLevel3_new$fitted.values

# aggregate IADL for US and SG
IADL_percentage_us <- aggregate(Prob_MedicalDelegate ~ IADL, data = test.data.us, mean)
IADL_percentage_sg <- aggregate(Prob_MedicalDelegate ~ IADL, data = test.data.sg, mean)

# convert probabilities to percentages
IADL_percentage_us$Prob_MedicalDelegate <- IADL_percentage_us$Prob_MedicalDelegate * 100
IADL_percentage_sg$Prob_MedicalDelegate <- IADL_percentage_sg$Prob_MedicalDelegate * 100

IADL_percentage_us$Country <- 'US'
IADL_percentage_sg$Country <- 'SG'
# dataframe
combined_data <- rbind(IADL_percentage_us, IADL_percentage_sg)
combined_data$IADL <- as.numeric(as.character(combined_data$IADL))

p <- ggplot(combined_data, aes(x = IADL, y = Prob_MedicalDelegate, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Prob_MedicalDelegate), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Medical Delegation by IADL",
       x = "IADL",
       y = "Percentage of Medical Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```

This plot shows that based on the Instrumental Activities of Daily Living (IADL) with a range [0,1], how individuals' percentage to delegate medical decisions differ in the US and SG. 
Both the green trend line (SG) and the blue trend line (US) exhibit an increase in the likelihood of medical delegation as IADL scores increase, which shows a positive correlation between IADL scores and the percentage of medical delegation.
Moreover, with the same IADL score, the Percentage of Medical Delegation is higher in SG compared with the US.




## ADL
```{r}
# fitted probabilities
test.data.us$Prob_MedicalDelegate = modelMedLevel1_new$fitted.values
test.data.sg$Prob_MedicalDelegate = modelMedLevel3_new$fitted.values

# aggregate ADL for US and SG
ADL_percentage_us <- aggregate(Prob_MedicalDelegate ~ ADL, data = test.data.us, mean)
ADL_percentage_sg <- aggregate(Prob_MedicalDelegate ~ ADL, data = test.data.sg, mean)

# convert probabilities to percentages
ADL_percentage_us$Prob_MedicalDelegate <- ADL_percentage_us$Prob_MedicalDelegate * 100
ADL_percentage_sg$Prob_MedicalDelegate <- ADL_percentage_sg$Prob_MedicalDelegate * 100

ADL_percentage_us$Country <- 'US'
ADL_percentage_sg$Country <- 'SG'
# dataframe
combined_data <- rbind(ADL_percentage_us, ADL_percentage_sg)
combined_data$ADL <- as.numeric(as.character(combined_data$ADL))

p <- ggplot(combined_data, aes(x = ADL, y = Prob_MedicalDelegate, group = Country)) +
  geom_bar(aes(fill = Country), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("US" = "lightblue", "SG" = "lightgreen")) +  # colors for bars
  geom_smooth(aes(color = Country), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", Prob_MedicalDelegate), fill = Country),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("US" = "blue", "SG" = "darkgreen")) +  # colors for trend lines
  theme_minimal() +
  labs(title = "Medical Delegation by ADL",
       x = "ADL",
       y = "Percentage of Medical Delegation") +
  guides(fill = guide_legend(title = "Country"), color = guide_legend(title = "Country"))

print(p)
```


This plot shows that based on the Activities of Daily Living (ADL) with a range [0,1], how individuals' percentage to delegate medical decisions differ in the US and SG. 
Both the green trend line (SG) and the blue trend line (US) exhibit an increase in the likelihood of medical delegation as ADL scores increase, which shows a positive correlation between ADL scores and the percentage of medical delegation.
Moreover, with the same ADL score, the Percentage of Medical Delegation is higher in SG compared with the US. And as ADL scores closer to 1, the percentage of Medical Delegation in these two countries gets closer as well. 


# Plots for significant predictors in US & SG model

## US Financial model

### Income
```{r}
# income
predicted_probs_finance <- predict(modelFinLevel1_new, type = "response")

test.data.us$predicted_probs_finance <- predicted_probs_finance

# Calculate predicted counts
test.data.us$predicted_count_finance <- ifelse(test.data.us$predicted_probs_finance > 0.5, 1, 0)

income_summary <- test.data.us %>%
  group_by(Income) %>%
  summarise(Proxy_Count = sum(predicted_count_finance),
            Total_Count = n()) %>%
  mutate(Proxy_Percentage = (Proxy_Count / Total_Count) * 100,
         Non_Proxy_Percentage = ((Total_Count - Proxy_Count) / Total_Count) * 100)

# long format
plot_data <- reshape2::melt(income_summary, id.vars = "Income", 
                            measure.vars = c("Proxy_Percentage", "Non_Proxy_Percentage"))

# labels = c("1" = "<$30k", "2" = "$30k", "3" = "$50k", "4" = "$100k", "5" = "$150k", "6" = ">$200k")
# Create the plot
ggplot(plot_data, aes(x = Income, y = value, fill = variable)) +
  geom_bar(aes(fill = variable), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("Proxy_Percentage" = "pink", "Non_Proxy_Percentage" = "lightgreen")) +
  geom_smooth(aes(color = variable), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", value), fill = variable),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("Proxy_Percentage" = "darkred", "Non_Proxy_Percentage" = "darkgreen")) +  # colors for trend lines
  theme_minimal()+
  labs(x = "Income", y = "Percentage Distribution Across Proxy Type",
       title = "Distribution in Houshold Income Among Financial Digital Proxies and Non-Proxies",
       fill = "Proxy Type") +
  guides(fill = guide_legend(title = "variable"), color = guide_legend(title = "variable"))
```

"1" = "<$30k", "2" = "$30k", "3" = "$50k", "4" = "$100k", "5" = "$150k", "6" = ">$200k"

This plot focuses on the significant predictor "income" in the US financial model. An increasing trend shows that as annual household income increases from <$30k to >$200k, the percentage of financial digital proxy increases as well, which means that the higher income a person has, the higher the probability he might help with financial proxy.

\newpage

### Gender
```{r}
# Gender
predicted_probs_finance <- predict(modelFinLevel1_new, type = "response")

test.data.us$predicted_probs_finance <- predicted_probs_finance

# Calculate predicted counts
test.data.us$predicted_count_finance <- ifelse(test.data.us$predicted_probs_finance > 0.5, 1, 0)

gender_summary <- test.data.us %>%
  group_by(Gender) %>%
  summarise(Proxy_Count = sum(predicted_count_finance),
            Total_Count = n()) %>%
  mutate(Proxy_Percentage = (Proxy_Count / Total_Count) * 100,
         Non_Proxy_Percentage = ((Total_Count - Proxy_Count) / Total_Count) * 100)

# long format
plot_data <- reshape2::melt(gender_summary, id.vars = "Gender", 
                            measure.vars = c("Proxy_Percentage", "Non_Proxy_Percentage"))

plot_data$Gender <- factor(plot_data$Gender, levels = c(1, 2), labels = c("Female","Male"))

# Create the plot
ggplot(plot_data, aes(x = Gender, y = value, fill = variable)) +
  geom_bar(aes(fill = variable), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("Proxy_Percentage" = "pink", "Non_Proxy_Percentage" = "lightgreen")) +
  geom_smooth(aes(color = variable), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", value), fill = variable),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("Proxy_Percentage" = "darkred", "Non_Proxy_Percentage" = "darkgreen")) +  # colors for trend lines
  theme_minimal()+
  labs(x = "Gender", y = "Percentage Distribution Across Proxy Type",
       title = "Distribution of Gender Among Financial Digital Proxies and Non-Proxies",
       fill = "Proxy Type") +
  guides(fill = guide_legend(title = "variable"), color = guide_legend(title = "variable"))
```

This plot focuses on the significant predictor "Gender" in the US financial model. It shows that female participants have a higher percentage in non-financial proxy and male participants have a higher percentage in financial proxy.


## US Medical model

### Gender
```{r}
# Gender
predicted_probs_finance <- predict(modelMedLevel1_new, type = "response")

test.data.us$predicted_probs_finance <- predicted_probs_finance

# Calculate predicted counts
test.data.us$predicted_count_finance <- ifelse(test.data.us$predicted_probs_finance > 0.5, 1, 0)

gender_summary <- test.data.us %>%
  group_by(Gender) %>%
  summarise(Proxy_Count = sum(predicted_count_finance),
            Total_Count = n()) %>%
  mutate(Proxy_Percentage = (Proxy_Count / Total_Count) * 100,
         Non_Proxy_Percentage = ((Total_Count - Proxy_Count) / Total_Count) * 100)

# long format
plot_data <- reshape2::melt(gender_summary, id.vars = "Gender", 
                            measure.vars = c("Proxy_Percentage", "Non_Proxy_Percentage"))

plot_data$Gender <- factor(plot_data$Gender, levels = c(1, 2), labels = c("Female","Male"))

# Create the plot
ggplot(plot_data, aes(x = Gender, y = value, fill = variable)) +
  geom_bar(aes(fill = variable), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("Proxy_Percentage" = "pink", "Non_Proxy_Percentage" = "lightgreen")) +
  geom_smooth(aes(color = variable), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", value), fill = variable),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("Proxy_Percentage" = "darkred", "Non_Proxy_Percentage" = "darkgreen")) +  # colors for trend lines
  theme_minimal()+
  labs(x = "Gender", y = "Percentage Distribution Across Proxy Type",
       title = "Distribution of Gender Among Financial Digital Proxies and Non-Proxies",
       fill = "Proxy Type") +
  guides(fill = guide_legend(title = "variable"), color = guide_legend(title = "variable"))
```

This plot focuses on the significant predictor "Gender" in the US medical model. It shows that female participants have higher percentage in non-financial proxy and male participants have higher percentage in financial proxy.


### Education
```{r}
# Gender
predicted_probs_finance <- predict(modelMedLevel1_new, type = "response")

test.data.us$predicted_probs_finance <- predicted_probs_finance

# Calculate predicted counts
# if probability >0.5, proxy_percentage
# if probability <0.5, non proxy_percentage
test.data.us$predicted_count_finance <- ifelse(test.data.us$predicted_probs_finance > 0.5, 1, 0)

education_summary <- test.data.us %>%
  group_by(Education) %>%
  summarise(Proxy_Count = sum(predicted_count_finance),
            Total_Count = n()) %>%
  mutate(Proxy_Percentage = (Proxy_Count / Total_Count) * 100,
         Non_Proxy_Percentage = ((Total_Count - Proxy_Count) / Total_Count) * 100)

# long format
plot_data <- reshape2::melt(education_summary, id.vars = "Education", 
                            measure.vars = c("Proxy_Percentage", "Non_Proxy_Percentage"))

#plot_data$Education <- factor(plot_data$Education, levels = c(1, 2, 3), labels = c("< High School","High School","Degree and above"))
# "< High School", "High School", "Degree and above"
# Create the plot
ggplot(plot_data, aes(x = Education, y = value, fill = variable)) +
  geom_bar(aes(fill = variable), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("Proxy_Percentage" = "pink", "Non_Proxy_Percentage" = "lightgreen")) +
  geom_smooth(aes(color = variable), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", value), fill = variable),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("Proxy_Percentage" = "darkred", "Non_Proxy_Percentage" = "darkgreen")) +  # colors for trend lines
  theme_minimal()+
  labs(x = "Education", y = "Percentage Distribution Across Proxy Type",
       title = "Distribution of Education Levels Among Financial Digital Proxies and Non-Proxies",
       fill = "Proxy Type") +
  guides(fill = guide_legend(title = "variable"), color = guide_legend(title = "variable"))
```

This plot focuses on the significant predictor "Education" in the US medical model. It shows that participants who have a higher education level (degree and above) might have a higher percentage of helping with financial proxy. And with the lowest education level (< high school), the percentage of nonfinancial proxy is the highest about 85.7%.

### Siblings
```{r}
# Gender
predicted_probs_finance <- predict(modelMedLevel1_new, type = "response")

test.data.us$predicted_probs_finance <- predicted_probs_finance

# Calculate predicted counts
test.data.us$predicted_count_finance <- ifelse(test.data.us$predicted_probs_finance > 0.5, 1, 0)

siblings_summary <- test.data.us %>%
  group_by(Siblings) %>%
  summarise(Proxy_Count = sum(predicted_count_finance),
            Total_Count = n()) %>%
  mutate(Proxy_Percentage = (Proxy_Count / Total_Count) * 100,
         Non_Proxy_Percentage = ((Total_Count - Proxy_Count) / Total_Count) * 100)

# long format
plot_data <- reshape2::melt(siblings_summary, id.vars = "Siblings", 
                            measure.vars = c("Proxy_Percentage", "Non_Proxy_Percentage"))
# Create the plot
ggplot(plot_data, aes(x = Siblings, y = value, fill = variable)) +
  geom_bar(aes(fill = variable), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("Proxy_Percentage" = "pink", "Non_Proxy_Percentage" = "lightgreen")) +
  geom_smooth(aes(color = variable), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", value), fill = variable),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("Proxy_Percentage" = "darkred", "Non_Proxy_Percentage" = "darkgreen")) +  # colors for trend lines
  theme_minimal()+
  labs(x = "Siblings", y = "Percentage Distribution Across Proxy Type",
       title = "Distribution of Siblings Levels Among Financial Digital Proxies and Non-Proxies",
       fill = "Proxy Type") +
  guides(fill = guide_legend(title = "variable"), color = guide_legend(title = "variable"))
```

This plot focuses on the significant predictor "Siblings" in the US medical model. It shows that participants who have more siblings might have a higher percentage of helping with financial proxy. 


## SG financial model

### Ethnicity
```{r}
# Ethnicity
predicted_probs_finance <- predict(modelFinLevel3_new, type = "response")

test.data.sg$predicted_probs_finance <- predicted_probs_finance

# Calculate predicted counts
test.data.sg$predicted_count_finance <- ifelse(test.data.sg$predicted_probs_finance > 0.5, 1, 0)

ethnicity_summary <- test.data.sg %>%
  group_by(Ethnicity) %>%
  summarise(Proxy_Count = sum(predicted_count_finance),
            Total_Count = n()) %>%
  mutate(Proxy_Percentage = (Proxy_Count / Total_Count) * 100,
         Non_Proxy_Percentage = ((Total_Count - Proxy_Count) / Total_Count) * 100)

# long format
plot_data <- reshape2::melt(ethnicity_summary, id.vars = "Ethnicity", 
                            measure.vars = c("Proxy_Percentage", "Non_Proxy_Percentage"))
plot_data$Ethnicity <- factor(plot_data$Ethnicity, levels = c(1, 2), labels = c("Majority","Underrepresented"))
# Create the plot
ggplot(plot_data, aes(x = Ethnicity, y = value, fill = variable)) +
  geom_bar(aes(fill = variable), stat = 'identity', position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("Proxy_Percentage" = "pink", "Non_Proxy_Percentage" = "lightgreen")) +
  geom_smooth(aes(color = variable), method = "lm", se = FALSE, linetype = "dashed", size = 1) + # trend lines
  geom_text(aes(label = sprintf("%.1f%%", value), fill = variable),
            position = position_dodge(width = 0.8), vjust = -0.5, size = 3) +
  scale_color_manual(values = c("Proxy_Percentage" = "darkred", "Non_Proxy_Percentage" = "darkgreen")) +  # colors for trend lines
  theme_minimal()+
  labs(x = "Ethnicity", y = "Percentage Distribution Across Proxy Type",
       title = "Distribution in Ethnicity Among Financial Digital Proxies and Non-Proxies",
       fill = "Proxy Type") +
  guides(fill = guide_legend(title = "variable"), color = guide_legend(title = "variable"))
```

This plot focuses on the significant predictor "Ethnicity" in the SG financial model. It shows that SG participants who have Underrepresented Ethnicity ("Malay", "Indian", "Eurasian") might have a higher percentage of delegating in making financial decisions compared with SG participants whose Ethnicity is "Chinese".  





```{r}
filtered.dat <- my.dat

filtered.dat <- subset(filtered.dat, !(HelpFriends=="101"))
filtered.dat <- subset(filtered.dat, !(FinanceHelpFriends=="101"))
filtered.dat <- subset(filtered.dat, !(MedicalHelpImmediateFam=="101"))
filtered.dat <- subset(filtered.dat, !(MedicalHelpFriends=="101"))

filtered.dat <- subset(filtered.dat, !(HelpFriends=="31"))
filtered.dat <- subset(filtered.dat, !(FinanceHelpFriends=="31"))
filtered.dat <- subset(filtered.dat, !(MedicalHelpImmediateFam=="31"))
filtered.dat <- subset(filtered.dat, !(MedicalHelpFriends=="31"))
filtered.dat <- subset(filtered.dat, !(FinanceJointAccount=="Exclude"))
filtered.dat <- subset(filtered.dat, !(Marital=="3"))

# Create test dataframe with only demographic predictors
test.data = filtered.dat[,c('Age','Income','Housing','Gender','Education','Employment','Ethnicity',
                            'Siblings','Marital')]

#how much help participants have provided for an adult in carrying out their instrumental activities of daily living
test.data$IADL = rowSums(filtered.dat[ , c("HelpTransport","HelpMed","HelpFinance","HelpFood","HelpLaundry","HelpHousekeep")])
test.data$IADL <- scale_values(test.data$IADL)
test.data$IADL <- round(test.data$IADL ,digit=2)

#how much help participants have provided for an adult in carrying out their activities of daily living
test.data$ADL = rowSums(filtered.dat[ , c("ADLBath","ADLFeed","ADLGroom","ADLIncontinence","ADLToilet","ADLTransfer")]) 
test.data$ADL <- scale_values(test.data$ADL)
test.data$ADL <- round(test.data$ADL ,digit=2)

#how much help participants have provided for an adult in carrying out low-stake medical care activities
test.data$lowstakeMed = rowSums(filtered.dat[ , c("MedicalMakeAppt","MedicalAccompanyAppt","MedicalTakeMeds","MedicalSeeTreatment")])

#how much help participants have provided for an adult in carrying out high-stake medical care activities
test.data$highstakeMed = rowSums(filtered.dat[ , c("MedicalDecisionPerson","MedicalDecisionDoctor","MedicalSignPapers","MedicalWorthPerson",
                                                   "MedicalWorthDoctor","MedicalWorthFamily","MedicalEndPerson","MedicalEndFamily",
                                                   "MedicalFlexibilityPerson","MedicalFlexibilityDoctor","MedicalFlexibilityFamily",
                                                   "MedicalDoctorQuestions")])

#DEPENDENT VARIABLES HERE
test.data$FinanceDelegate1 = as.factor(filtered.dat$FinanceDelegate1)
test.data$FinanceDelegate2 = as.factor(filtered.dat$FinanceDelegate2)
test.data$MedicalDelegate1 = as.factor(filtered.dat$MedicalDelegate1)
test.data$MedicalDelegate2 = as.factor(filtered.dat$MedicalDelegate2)

#Assist vs. No
test.data$FinanceDelegate1 = factor(test.data$FinanceDelegate1,
                                    levels = c("Assist","No"),
                                    labels = c("1","0"))
test.data$FinanceDelegate1 <- as.numeric(as.character(test.data$FinanceDelegate1))

#Assist vs. No
test.data$MedicalDelegate1 = factor(test.data$MedicalDelegate1,
                                    levels = c("Assist","No"),
                                    labels = c("1","0"))
test.data$MedicalDelegate1 <- as.numeric(as.character(test.data$MedicalDelegate1))
```


```{r}
# Create a new variable that is 1 if the individual is a delegate for both duties, and 0 otherwise
test.data.sg$BothDelegations <- with(test.data.sg, as.integer(MedicalDelegate1 == 1 & FinanceDelegate1 == 1))

# Calculate the total number of individuals who are delegates for both duties
both_delegations_count <- sum(test.data.sg$BothDelegations)

# Calculate the total number of proxies
total_proxies <- nrow(test.data.sg)

# Calculate the percentage
percentage_both_delegations <- (both_delegations_count / total_proxies) * 100

# Print the percentage
print(percentage_both_delegations)
```


```{r}
both_delegations_count<-sum(as.integer(test.data.sg$MedicalDelegate1 == 1 & test.data.sg$FinanceDelegate1 == 1))
total_proxies <- nrow(test.data.sg)
percentage_both_delegations <- (both_delegations_count / total_proxies) * 100
print(percentage_both_delegations)
```

```{r}
# for participants who do both medical and financial delegates
library(dplyr)
sg_both <- test.data.sg %>%
  filter(MedicalDelegate1 == 1 & FinanceDelegate1 == 1)
sg_both_sum <- sum(as.integer(sg_both$MedicalDelegate1 == 1 & sg_both$FinanceDelegate1 == 1))
# sum(sg_both$MedicalDelegate1 == 1)
formal_both<-sum(as.integer(sg_both$FinanceDelegate2 == "Assist-formal" & sg_both$MedicalDelegate2 == "Assist-formal"))
informal_both<-sum(as.integer(sg_both$FinanceDelegate2 == "Assist-Informal" & sg_both$MedicalDelegate2 == "Assist-informal"))
percentage_formal_both<-(formal_both / sg_both_sum) * 100
print(percentage_formal_both)
percentage_informal_both<-(informal_both / sg_both_sum) * 100
print(percentage_informal_both)



# for participants who only do medical delegates
sg_not_both <- test.data.sg %>%
  filter(MedicalDelegate1 == 0 | FinanceDelegate1 == 0)

medical_assit<-sum(sg_not_both$MedicalDelegate1 == 1)
formal_medical<-sum(sg_not_both$MedicalDelegate2 == "Assist-formal")
informal_medical<-sum(sg_not_both$MedicalDelegate2 == "Assist-informal")
percentage_formal<-(formal_medical/medical_assit) * 100
print(percentage_formal)
percentage_informal<-(informal_medical/medical_assit) * 100
print(percentage_informal)


# for participants who only do fiancial delegates

finance_assit<-sum(sg_not_both$FinanceDelegate1 == 1)
formal_finance<-sum(sg_not_both$FinanceDelegate2 == "Assist-formal")
informal_finance<-sum(sg_not_both$FinanceDelegate2 == "Assist-Informal")
percentage_formal<-(formal_finance/finance_assit) * 100
print(percentage_formal)
percentage_informal<-(informal_finance/finance_assit) * 100
print(percentage_informal)

```



```{r}
# digital_proxySG
# Provides min, median, mean, max, and quartiles

sg_not_both$Age <- factor(sg_not_both$Age, 
                         levels = c("1","2", "3", "4", "5", "6", "7", "8", "9", "10", "11"),
                         labels = c("21","25", "30", "35", "40", "45", "50", "55", "60", "65", "70"), ordered = TRUE)
sg_not_both$Age <- as.factor(as.character(sg_not_both$Age))
# sg_not_both$Age <- as.numeric(sg_not_both$Age) ###
# ordering <- c("21","25", "30", "35", "40", "45", "50", "55", "60", "65", "70")
# orderFactor <- factor(my.dat$Age, levels = ordering)
# my.dat$Age <- as.numeric(orderFactor)
prop.table(table(sg_not_both$Age)) * 100
summary(sg_not_both$Age)

# Percentage of each category in Education
table(sg_not_both$Education)
prop.table(table(sg_not_both$Education)) * 100  

# Percentage of each category in Religion
prop.table(table(sg_not_both$Religion)) * 100  

# Percentage of each category in Ethnicity
prop.table(table(sg_not_both$Ethnicity)) * 100
prop.table(table(digital_proxySG$Ethnicity)) * 100 

# summary of IADL
summary(sg_not_both$IADL)
sd(sg_not_both$IADL)

# summary of ADL
summary(sg_not_both$ADL)
sd(sg_not_both$ADL)
```

* Descriptive statistics for participants who only do medical delegates or financial delegates (significant predictors in SG model):
  + Age (categorical)
    - 21-24 (9.523810%), 25-29 (7.142857%), 30-34 (6.666667%), 35-39 (8.571429%), 40-44 (7.142857%), 45-49 (10.952381%), 50-54 (10.476190%), 55-59 (19.523810%), 60-64 (15.238095%), 65-69 (3.333333%), 70 and above (1.428571%%)
    - N = 210
    
  + Education (ordinal)
    - Percentage: < High School (3.333333%), High School (44.761905%), Degree and above (51.904762%)
    - N = 210
    
  + Ethnicity (categorical) 
    - Percentage: Majority (81.90476%), Underrepresented (18.09524%)
    - N = 210
    - Percentage (Original Dataset): Chinese (78.4565916%), Eurasian (1.9292605%), Indian (4.8231511%), Malay (12.2186495%), Mixed (0.6430868%), Others (1.9292605%)
    - N = 311
    
  + IADL (numerical)
    - mean: 0.4171
    - median: 0.4200
    - Interquartile Range (IQR): 1st Qu. 0.1700, 3rd Qu. 0.6700
    - standard deviation: 0.2887436
    
  + ADL (numerical)
    - mean: 0.2302
    - median: 0.0000
    - Interquartile Range (IQR): 1st Qu. 0.0000, 3rd Qu. 0.4200
    - standard deviation: 0.3263008
    
  + Religion(categorical)
    - Percentage: Buddhist (33.333333%), Catholicism (3.333333%), Christianity (20.952381%), Hinduism (3.333333%), Islam (12.380952%), No Religion (21.904762%), Taoism (4.761905%)
    - N = 210
    - A total of 210 participants


